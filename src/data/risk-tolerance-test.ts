/**
 * Тест на толерантность к риску
 * Определяет уровень готовности к принятию рисков в различных сферах жизни
 */

export interface RiskToleranceQuestion {
  id: string;
  text: string;
  category: 'financial' | 'career' | 'personal' | 'social' | 'health' | 'investment';
  scenario?: string;
  options: {
    text: string;
    score: number; // 1 (очень низкая толерантность) до 5 (очень высокая толерантность)
  }[];
}

export interface RiskToleranceResult {
  overall_level: 'very_low' | 'low' | 'moderate' | 'high' | 'very_high';
  total_score: number; // от 20 до 100
  percentage: number; // 0-100
  title: string;
  description: string;
  category_scores: {
    financial: number;    // Финансовые риски
    career: number;       // Карьерные риски
    personal: number;     // Личные риски
    social: number;       // Социальные риски
    health: number;       // Риски для здоровья
    investment: number;   // Инвестиционные риски
  };
  strengths: string[];
  challenges: string[];
  risk_behaviors: string[];
  decision_style: string[];
  investment_profile: string[];
  career_implications: string[];
  life_recommendations: string[];
  growth_strategies: string[];
  warning_signs: string[];
}

export const riskToleranceQuestions: RiskToleranceQuestion[] = [
  {
    id: '1',
    text: 'Вы рассматриваете возможность инвестировать 10% от своих сбережений. Какой вариант вы выберете?',
    category: 'investment',
    options: [
      { text: 'Банковский депозит с гарантированной доходностью 3-5%', score: 1 },
      { text: 'Консервативный инвестиционный фонд с доходностью 5-8%', score: 2 },
      { text: 'Сбалансированный портфель акций и облигаций', score: 3 },
      { text: 'Акции растущих компаний с высоким потенциалом', score: 4 },
      { text: 'Криптовалюты или стартапы с возможностью больших прибылей', score: 5 }
    ]
  },
  {
    id: '2',
    text: 'Вам предлагают новую работу с зарплатой в 2 раза выше, но в нестабильной компании. Ваши действия:',
    category: 'career',
    options: [
      { text: 'Отказываюсь - стабильность важнее денег', score: 1 },
      { text: 'Детально изучаю компанию и рынок', score: 2 },
      { text: 'Принимаю предложение, но ищу запасные варианты', score: 3 },
      { text: 'Соглашаюсь - высокий доход компенсирует риски', score: 4 },
      { text: 'Сразу соглашаюсь - люблю новые вызовы', score: 5 }
    ]
  },
  {
    id: '3',
    text: 'При планировании отпуска вы предпочитаете:',
    category: 'personal',
    options: [
      { text: 'Проверенные курорты с заранее забронированным жильем', score: 1 },
      { text: 'Популярные направления с частичным планированием', score: 2 },
      { text: 'Смесь запланированных и спонтанных активностей', score: 3 },
      { text: 'Новые места с минимальным планированием', score: 4 },
      { text: 'Полностью спонтанное путешествие по настроению', score: 5 }
    ]
  },
  {
    id: '4',
    text: 'Ваш друг предлагает заняться экстремальным спортом. Ваша реакция:',
    category: 'health',
    options: [
      { text: 'Категорически отказываюсь - это слишком опасно', score: 1 },
      { text: 'Предлагаю менее рискованные альтернативы', score: 2 },
      { text: 'Соглашаюсь при условии максимальных мер безопасности', score: 3 },
      { text: 'С удовольствием попробую что-то новое', score: 4 },
      { text: 'Обожаю адреналин - сразу соглашаюсь!', score: 5 }
    ]
  },
  {
    id: '5',
    text: 'На вечеринке вас просят выступить с импровизированной речью. Вы:',
    category: 'social',
    options: [
      { text: 'Вежливо отказываюсь - не готов к такому', score: 1 },
      { text: 'Прошу время подумать и подготовиться', score: 2 },
      { text: 'Соглашаюсь, но волнуюсь', score: 3 },
      { text: 'С радостью принимаю вызов', score: 4 },
      { text: 'Обожаю внимание - сразу соглашаюсь', score: 5 }
    ]
  },
  {
    id: '6',
    text: 'У вас есть возможность открыть свой бизнес, вложив большую часть сбережений. Вы:',
    category: 'financial',
    options: [
      { text: 'Не рискую - предпочитаю стабильную зарплату', score: 1 },
      { text: 'Изучаю вопрос полгода, советуюсь с экспертами', score: 2 },
      { text: 'Начинаю с минимальных вложений и тестирую', score: 3 },
      { text: 'Инвестирую значительную сумму в перспективную идею', score: 4 },
      { text: 'Полностью ухожу в бизнес - все или ничего!', score: 5 }
    ]
  },
  {
    id: '7',
    text: 'Вам предлагают переехать в другую страну по работе на 2 года. Ваше решение:',
    category: 'career',
    options: [
      { text: 'Отказываюсь - не готов к таким переменам', score: 1 },
      { text: 'Долго взвешиваю все за и против', score: 2 },
      { text: 'Соглашаюсь при хороших условиях', score: 3 },
      { text: 'Принимаю предложение - это отличная возможность', score: 4 },
      { text: 'Сразу соглашаюсь - обожаю перемены!', score: 5 }
    ]
  },
  {
    id: '8',
    text: 'При выборе ресторана в незнакомом городе вы:',
    category: 'personal',
    options: [
      { text: 'Ищу проверенные сетевые рестораны', score: 1 },
      { text: 'Выбираю по рейтингам в интернете', score: 2 },
      { text: 'Спрашиваю рекомендации у местных', score: 3 },
      { text: 'Захожу в первый понравившийся', score: 4 },
      { text: 'Специально ищу самые экзотические места', score: 5 }
    ]
  },
  {
    id: '9',
    text: 'Ваш портфель инвестиций падает в цене на 20% за месяц. Вы:',
    category: 'investment',
    options: [
      { text: 'Продаю все и перехожу к безопасным активам', score: 1 },
      { text: 'Продаю часть и жду стабилизации', score: 2 },
      { text: 'Держу позиции и жду восстановления', score: 3 },
      { text: 'Докупаю активы по сниженным ценам', score: 4 },
      { text: 'Значительно увеличиваю вложения - покупаю на дипе', score: 5 }
    ]
  },
  {
    id: '10',
    text: 'Вы можете получить премию: либо гарантированные $1000, либо 50% шанс получить $2500. Что выберете?',
    category: 'financial',
    options: [
      { text: 'Однозначно $1000 - синица в руках', score: 1 },
      { text: 'Скорее всего $1000, но подумаю', score: 2 },
      { text: 'Сложный выбор, может попробую риск', score: 3 },
      { text: 'Выберу шанс на $2500 - потенциал выше', score: 4 },
      { text: 'Определенно риск - люблю азарт!', score: 5 }
    ]
  },
  {
    id: '11',
    text: 'При смене профессиональной сферы вы предпочитаете:',
    category: 'career',
    options: [
      { text: 'Смежную область, где навыки частично применимы', score: 1 },
      { text: 'Постепенный переход с дополнительным обучением', score: 2 },
      { text: 'Кардинальную смену с серьезной подготовкой', score: 3 },
      { text: 'Полный переход в новую интересную сферу', score: 4 },
      { text: 'Кардинальные перемены без особой подготовки', score: 5 }
    ]
  },
  {
    id: '12',
    text: 'Ваша реакция на возможность попробовать экзотическую еду:',
    category: 'health',
    options: [
      { text: 'Предпочитаю знакомые блюда', score: 1 },
      { text: 'Попробую только в проверенных местах', score: 2 },
      { text: 'Попробую, но осторожно', score: 3 },
      { text: 'С удовольствием попробую новое', score: 4 },
      { text: 'Чем экзотичнее, тем интереснее!', score: 5 }
    ]
  },
  {
    id: '13',
    text: 'При выборе места жительства важнее всего:',
    category: 'personal',
    options: [
      { text: 'Безопасность и стабильность района', score: 1 },
      { text: 'Развитая инфраструктура и удобство', score: 2 },
      { text: 'Баланс между комфортом и новыми возможностями', score: 3 },
      { text: 'Перспективы развития и рост стоимости', score: 4 },
      { text: 'Уникальность и необычность места', score: 5 }
    ]
  },
  {
    id: '14',
    text: 'В социальных сетях вы:',
    category: 'social',
    options: [
      { text: 'Делюсь только проверенной информацией', score: 1 },
      { text: 'Осторожно выражаю свое мнение', score: 2 },
      { text: 'Участвую в обсуждениях по интересным темам', score: 3 },
      { text: 'Открыто высказываю свою позицию', score: 4 },
      { text: 'Не боюсь спорных тем и острых дискуссий', score: 5 }
    ]
  },
  {
    id: '15',
    text: 'Ваш подход к планированию пенсии:',
    category: 'investment',
    options: [
      { text: 'Только государственная пенсия и депозиты', score: 1 },
      { text: 'Негосударственные пенсионные фонды', score: 2 },
      { text: 'Сбалансированный портфель консервативных инвестиций', score: 3 },
      { text: 'Агрессивные инвестиции в акции и недвижимость', score: 4 },
      { text: 'Рискованные инвестиции с высокой доходностью', score: 5 }
    ]
  },
  {
    id: '16',
    text: 'Если ваше мнение кардинально отличается от мнения группы, вы:',
    category: 'social',
    options: [
      { text: 'Молчу и следую за большинством', score: 1 },
      { text: 'Тактично выражаю альтернативную точку зрения', score: 2 },
      { text: 'Аргументированно отстаиваю свою позицию', score: 3 },
      { text: 'Открыто высказываю свое несогласие', score: 4 },
      { text: 'Не боюсь идти против всех', score: 5 }
    ]
  },
  {
    id: '17',
    text: 'При покупке дорогой техники вы:',
    category: 'financial',
    options: [
      { text: 'Покупаю только проверенные бренды с гарантией', score: 1 },
      { text: 'Изучаю отзывы и характеристики', score: 2 },
      { text: 'Балансирую между ценой и качеством', score: 3 },
      { text: 'Готов переплатить за новые технологии', score: 4 },
      { text: 'Одним из первых покупаю новинки', score: 5 }
    ]
  },
  {
    id: '18',
    text: 'Ваш подход к изучению нового языка за границей:',
    category: 'personal',
    options: [
      { text: 'Подготовка дома с последующими курсами за рубежом', score: 1 },
      { text: 'Интенсивные курсы в языковой школе', score: 2 },
      { text: 'Сочетание учебы и общения с носителями', score: 3 },
      { text: 'Полное погружение в языковую среду', score: 4 },
      { text: 'Только общение с местными без формального обучения', score: 5 }
    ]
  },
  {
    id: '19',
    text: 'Если врач рекомендует экспериментальное лечение, вы:',
    category: 'health',
    options: [
      { text: 'Выбираю только проверенные методы', score: 1 },
      { text: 'Ищу второе мнение и дополнительную информацию', score: 2 },
      { text: 'Взвешиваю все риски и потенциальные выгоды', score: 3 },
      { text: 'Доверяю специалисту и готов попробовать', score: 4 },
      { text: 'Соглашаюсь - новые методы часто эффективнее', score: 5 }
    ]
  },
  {
    id: '20',
    text: 'При выборе инвестиционной стратегии вы предпочитаете:',
    category: 'investment',
    options: [
      { text: 'Максимальную сохранность капитала', score: 1 },
      { text: 'Стабильный доход с минимальными рисками', score: 2 },
      { text: 'Сбалансированный рост с умеренными рисками', score: 3 },
      { text: 'Агрессивный рост с принятием высоких рисков', score: 4 },
      { text: 'Максимальную доходность, несмотря на риски', score: 5 }
    ]
  }
];

export const calculateRiskToleranceResult = (answers: Record<string, number>): RiskToleranceResult => {
  const total_score = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((total_score - 20) / 80) * 100);

  // Подсчет баллов по категориям
  const category_scores = {
    financial: 0,
    career: 0,
    personal: 0,
    social: 0,
    health: 0,
    investment: 0
  };

  const categoryCount = {
    financial: 0,
    career: 0,
    personal: 0,
    social: 0,
    health: 0,
    investment: 0
  };

  riskToleranceQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer !== undefined) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям (средний балл * 20)
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
  });

  let overall_level: 'very_low' | 'low' | 'moderate' | 'high' | 'very_high';
  let title: string;
  let description: string;
  let strengths: string[];
  let challenges: string[];
  let risk_behaviors: string[];
  let decision_style: string[];
  let investment_profile: string[];
  let career_implications: string[];
  let life_recommendations: string[];
  let growth_strategies: string[];
  let warning_signs: string[];

  if (total_score <= 35) {
    overall_level = 'very_low';
    title = 'Очень низкая толерантность к риску';
    description = 'Вы предпочитаете максимальную безопасность и избегаете любых рискованных ситуаций. Стабильность и предсказуемость являются для вас приоритетными ценностями. Это может обеспечить спокойствие, но может ограничить возможности роста.';
    strengths = [
      'Высокая финансовая дисциплина',
      'Осторожность в принятии решений',
      'Хорошая способность к долгосрочному планированию',
      'Стабильность в жизни и карьере',
      'Ответственный подход к безопасности'
    ];
    challenges = [
      'Упущение возможностей роста',
      'Медленное накопление капитала',
      'Ограниченное карьерное развитие',
      'Трудности с адаптацией к переменам',
      'Возможная социальная изоляция'
    ];
    warning_signs = [
      'Полное избегание любых инвестиций',
      'Отказ от карьерных возможностей из-за страха',
      'Социальная изоляция из-за боязни осуждения',
      'Чрезмерное беспокойство о безопасности'
    ];
  } else if (total_score <= 50) {
    overall_level = 'low';
    title = 'Низкая толерантность к риску';
    description = 'Вы осторожны в принятии решений и предпочитаете проверенные пути. Готовы принять минимальные риски только при наличии высоких гарантий. Ваш подход консервативен, но разумен.';
    strengths = [
      'Взвешенный подход к решениям',
      'Хорошая оценка рисков',
      'Надежность в финансовых вопросах',
      'Стабильность в отношениях и карьере',
      'Умение планировать на долгосрок'
    ];
    challenges = [
      'Медленный карьерный рост',
      'Консервативные инвестиции',
      'Упущение некоторых возможностей',
      'Трудности с инновациями'
    ];
    warning_signs = [
      'Избегание всех форм инвестирования',
      'Отказ от повышения из-за новых обязанностей',
      'Ограничение социальных контактов'
    ];
  } else if (total_score <= 65) {
    overall_level = 'moderate';
    title = 'Умеренная толерантность к риску';
    description = 'У вас сбалансированный подход к рискам. Вы готовы принимать обдуманные риски, если потенциальная выгода оправдывает возможные потери. Это здоровый и адаптивный подход к жизненным решениям.';
    strengths = [
      'Сбалансированный подход к решениям',
      'Способность оценивать соотношение риск/доходность',
      'Гибкость в стратегиях',
      'Адаптивность к обстоятельствам',
      'Разумная диверсификация'
    ];
    challenges = [
      'Иногда чрезмерная осторожность',
      'Потребность в дополнительном времени на решения',
      'Колебания между безопасностью и возможностями'
    ];
    warning_signs = [
      'Чрезмерный анализ без принятия решений',
      'Упущение срочных возможностей из-за осторожности'
    ];
  } else if (total_score <= 80) {
    overall_level = 'high';
    title = 'Высокая толерантность к риску';
    description = 'Вы готовы принимать значительные риски ради потенциально высоких вознаграждений. Вам нравятся вызовы и новые возможности. Этот подход может привести к большим успехам, но требует осознанности.';
    strengths = [
      'Готовность к новым возможностям',
      'Предпринимательский дух',
      'Быстрое принятие решений',
      'Адаптивность к переменам',
      'Потенциал высоких достижений'
    ];
    challenges = [
      'Возможность значительных потерь',
      'Импульсивность в решениях',
      'Недооценка рисков',
      'Нестабильность доходов'
    ];
    warning_signs = [
      'Игнорирование очевидных предупреждающих сигналов',
      'Чрезмерная концентрация в одной области',
      'Пренебрежение страхованием и безопасностью'
    ];
  } else {
    overall_level = 'very_high';
    title = 'Очень высокая толерантность к риску';
    description = 'Вы готовы принимать экстремальные риски и не боитесь неопределенности. Адреналин и возможность больших выигрышей мотивируют вас больше, чем страх потерь. Это может привести как к выдающимся успехам, так и к серьезным проблемам.';
    strengths = [
      'Исключительная готовность к переменам',
      'Высокий предпринимательский потенциал',
      'Способность к прорывным решениям',
      'Бесстрашие в новых ситуациях',
      'Потенциал экстраординарных достижений'
    ];
    challenges = [
      'Высокая вероятность серьезных потерь',
      'Импульсивность и недостаток анализа',
      'Игнорирование базовой безопасности',
      'Нестабильность во всех сферах жизни'
    ];
    warning_signs = [
      'Полное игнорирование рисков',
      'Ставка всего на одну карту',
      'Пренебрежение здоровьем и безопасностью',
      'Разрушение отношений ради риска'
    ];
  }

  // Поведенческие паттерны
  if (overall_level === 'very_low' || overall_level === 'low') {
    risk_behaviors = [
      'Избегание неопределенных ситуаций',
      'Предпочтение проверенных решений',
      'Медленное принятие решений',
      'Поиск гарантий и подтверждений',
      'Консервативное финансовое поведение'
    ];

    decision_style = [
      'Тщательный анализ всех рисков',
      'Консультации с экспертами',
      'Поиск максимальных гарантий',
      'Предпочтение статус-кво',
      'Постепенные изменения'
    ];

    investment_profile = [
      'Банковские депозиты',
      'Государственные облигации',
      'Консервативные ПИФы',
      'Страховые продукты',
      'Недвижимость в стабильных районах'
    ];

    career_implications = [
      'Предпочтение стабильных компаний',
      'Долгосрочная работа в одном месте',
      'Избегание стартапов и новых проектов',
      'Консервативные карьерные цели',
      'Предпочтение гарантированного дохода'
    ];

    life_recommendations = [
      'Постепенно расширяйте зону комфорта',
      'Начните с небольших рисков',
      'Изучайте успешные примеры',
      'Создайте финансовую подушку безопасности',
      'Инвестируйте в образование и навыки'
    ];

    growth_strategies = [
      'Постановка маленьких, достижимых целей',
      'Изучение основ инвестирования',
      'Развитие предпринимательского мышления',
      'Networking и расширение связей',
      'Работа с финансовым консультантом'
    ];
  } else if (overall_level === 'moderate') {
    risk_behaviors = [
      'Взвешенный подход к решениям',
      'Диверсификация рисков',
      'Анализ соотношения риск/доходность',
      'Адаптивные стратегии',
      'Умеренное инвестирование'
    ];

    decision_style = [
      'Сбалансированный анализ',
      'Учет множественных факторов',
      'Консультации при необходимости',
      'Гибкость в подходах',
      'Разумная скорость решений'
    ];

    investment_profile = [
      'Сбалансированные портфели',
      'Смешанные инвестиции',
      'Индексные фонды',
      'Умеренно агрессивные стратегии',
      'Диверсифицированная недвижимость'
    ];

    career_implications = [
      'Сбалансированный карьерный рост',
      'Готовность к обоснованным переменам',
      'Развитие в перспективных областях',
      'Баланс стабильности и роста',
      'Инвестиции в профессиональное развитие'
    ];

    life_recommendations = [
      'Поддерживайте здоровый баланс',
      'Регулярно пересматривайте стратегии',
      'Развивайте навыки анализа рисков',
      'Изучайте новые возможности',
      'Создавайте резервные планы'
    ];

    growth_strategies = [
      'Развитие аналитических навыков',
      'Изучение новых инвестиционных инструментов',
      'Расширение профессиональных компетенций',
      'Построение разнообразного портфеля',
      'Регулярный мониторинг результатов'
    ];
  } else {
    risk_behaviors = [
      'Быстрое принятие решений',
      'Готовность к экспериментам',
      'Поиск новых возможностей',
      'Высокие ставки на перспективы',
      'Агрессивное инвестирование'
    ];

    decision_style = [
      'Интуитивные решения',
      'Фокус на возможностях, а не на рисках',
      'Быстрая адаптация',
      'Предпринимательский подход',
      'Готовность к экспериментам'
    ];

    investment_profile = [
      'Акции роста',
      'Венчурные инвестиции',
      'Криптовалюты',
      'Стартапы и новые технологии',
      'Альтернативные инвестиции'
    ];

    career_implications = [
      'Предпринимательская деятельность',
      'Работа в стартапах и новых отраслях',
      'Быстрый карьерный рост',
      'Готовность к кардинальным переменам',
      'Инновационные проекты'
    ];

    life_recommendations = [
      'Создайте системы контроля рисков',
      'Диверсифицируйте источники дохода',
      'Инвестируйте в страхование',
      'Изучайте управление рисками',
      'Сохраняйте связь с консервативными советниками'
    ];

    growth_strategies = [
      'Развитие навыков управления рисками',
      'Создание систем мониторинга',
      'Обучение финансовой грамотности',
      'Построение команды консультантов',
      'Регулярный анализ результатов'
    ];
  }

  return {
    overall_level,
    total_score,
    percentage,
    title,
    description,
    category_scores,
    strengths,
    challenges,
    risk_behaviors,
    decision_style,
    investment_profile,
    career_implications,
    life_recommendations,
    growth_strategies,
    warning_signs
  };
};