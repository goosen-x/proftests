/**
 * Тест на эмоциональную стабильность
 * Оценивает способность справляться со стрессом и эмоциональными вызовами
 */

export interface EmotionalStabilityQuestion {
  id: string;
  text: string;
  category:
    | 'stress_response'
    | 'emotional_regulation'
    | 'resilience'
    | 'anxiety_management'
    | 'mood_stability';
  options: {
    text: string;
    score: number; // 1 (низкая стабильность) до 5 (высокая стабильность)
  }[];
}

export interface EmotionalStabilityResult {
  overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  total_score: number; // от 20 до 100
  percentage: number; // 0-100
  title: string;
  description: string;
  category_scores: {
    stress_response: number; // Реакция на стресс
    emotional_regulation: number; // Эмоциональная регуляция
    resilience: number; // Устойчивость
    anxiety_management: number; // Управление тревогой
    mood_stability: number; // Стабильность настроения
  };
  strengths: string[];
  challenges: string[];
  stress_symptoms: string[];
  coping_strategies: string[];
  lifestyle_recommendations: string[];
  professional_help: string[];
  development_exercises: string[];
  warning_signs: string[];
  support_systems: string[];
}

export const emotionalStabilityQuestions: EmotionalStabilityQuestion[] = [
  {
    id: '1',
    text: 'Как часто вы чувствуете себя подавленным стрессом?',
    category: 'stress_response',
    options: [
      { text: 'Очень часто, почти каждый день', score: 1 },
      { text: 'Часто, несколько раз в неделю', score: 2 },
      { text: 'Иногда, несколько раз в месяц', score: 3 },
      { text: 'Редко, только в особых ситуациях', score: 4 },
      { text: 'Практически никогда', score: 5 },
    ],
  },
  {
    id: '2',
    text: 'Насколько легко вы восстанавливаетесь после неудач?',
    category: 'resilience',
    options: [
      { text: 'Очень тяжело, долго не могу прийти в себя', score: 1 },
      { text: 'Тяжело, нужно много времени', score: 2 },
      { text: 'Средне, постепенно прихожу в норму', score: 3 },
      { text: 'Довольно быстро восстанавливаюсь', score: 4 },
      { text: 'Очень быстро, практически сразу', score: 5 },
    ],
  },
  {
    id: '3',
    text: 'Как часто ваше настроение резко меняется в течение дня?',
    category: 'mood_stability',
    options: [
      { text: 'Очень часто, как на качелях', score: 1 },
      { text: 'Часто, настроение непредсказуемо', score: 2 },
      { text: 'Иногда, зависит от обстоятельств', score: 3 },
      { text: 'Редко, обычно настроение стабильно', score: 4 },
      { text: 'Практически никогда, очень стабильно', score: 5 },
    ],
  },
  {
    id: '4',
    text: 'Как вы справляетесь с тревожными мыслями?',
    category: 'anxiety_management',
    options: [
      { text: 'Очень плохо, они меня парализуют', score: 1 },
      { text: 'Плохо, часто захватывают полностью', score: 2 },
      { text: 'Средне, иногда удается контролировать', score: 3 },
      { text: 'Хорошо, обычно могу справиться', score: 4 },
      { text: 'Отлично, легко их контролирую', score: 5 },
    ],
  },
  {
    id: '5',
    text: 'Насколько хорошо вы контролируете свои эмоции в конфликтных ситуациях?',
    category: 'emotional_regulation',
    options: [
      { text: 'Очень плохо, часто взрываюсь', score: 1 },
      { text: 'Плохо, эмоции берут верх', score: 2 },
      { text: 'Средне, иногда теряю контроль', score: 3 },
      { text: 'Хорошо, обычно сдерживаюсь', score: 4 },
      { text: 'Отлично, всегда контролирую себя', score: 5 },
    ],
  },
  {
    id: '6',
    text: 'Как долго вы переживаете из-за критики в свой адрес?',
    category: 'resilience',
    options: [
      { text: 'Очень долго, недели или месяцы', score: 1 },
      { text: 'Долго, несколько дней', score: 2 },
      { text: 'Средне, день-два', score: 3 },
      { text: 'Недолго, несколько часов', score: 4 },
      { text: 'Очень быстро забываю', score: 5 },
    ],
  },
  {
    id: '7',
    text: 'Как часто вы испытываете физические симптомы стресса (головные боли, напряжение)?',
    category: 'stress_response',
    options: [
      { text: 'Постоянно, каждый день', score: 1 },
      { text: 'Очень часто, несколько раз в неделю', score: 2 },
      { text: 'Иногда, несколько раз в месяц', score: 3 },
      { text: 'Редко, только при сильном стрессе', score: 4 },
      { text: 'Практически никогда', score: 5 },
    ],
  },
  {
    id: '8',
    text: 'Насколько легко вас расстроить или разозлить?',
    category: 'emotional_regulation',
    options: [
      { text: 'Очень легко, из-за мелочей', score: 1 },
      { text: 'Легко, часто реагирую эмоционально', score: 2 },
      { text: 'Средне, зависит от ситуации', score: 3 },
      { text: 'Сложно, нужны серьезные причины', score: 4 },
      { text: 'Очень сложно, редко теряю спокойствие', score: 5 },
    ],
  },
  {
    id: '9',
    text: 'Как вы справляетесь с неопределенностью и непредсказуемыми ситуациями?',
    category: 'anxiety_management',
    options: [
      { text: 'Очень плохо, впадаю в панику', score: 1 },
      { text: 'Плохо, сильно нервничаю', score: 2 },
      { text: 'Средне, испытываю дискомфорт', score: 3 },
      { text: 'Хорошо, адаптируюсь довольно быстро', score: 4 },
      { text: 'Отлично, воспринимаю как вызов', score: 5 },
    ],
  },
  {
    id: '10',
    text: 'Как часто вы чувствуете себя эмоционально истощенным?',
    category: 'stress_response',
    options: [
      { text: 'Постоянно, каждый день', score: 1 },
      { text: 'Очень часто, большую часть времени', score: 2 },
      { text: 'Иногда, периодами', score: 3 },
      { text: 'Редко, только после сложных периодов', score: 4 },
      { text: 'Практически никогда', score: 5 },
    ],
  },
  {
    id: '11',
    text: 'Насколько хорошо вы можете "переключиться" с негативных эмоций?',
    category: 'emotional_regulation',
    options: [
      { text: 'Очень плохо, застреваю в негативе', score: 1 },
      { text: 'Плохо, долго не могу отвлечься', score: 2 },
      { text: 'Средне, иногда получается', score: 3 },
      { text: 'Хорошо, обычно могу переключиться', score: 4 },
      { text: 'Отлично, легко меняю фокус', score: 5 },
    ],
  },
  {
    id: '12',
    text: 'Как вы реагируете на изменения в планах?',
    category: 'resilience',
    options: [
      { text: 'Очень плохо, впадаю в стресс', score: 1 },
      { text: 'Плохо, сильно расстраиваюсь', score: 2 },
      { text: 'Средне, нужно время на адаптацию', score: 3 },
      { text: 'Хорошо, довольно гибко адаптируюсь', score: 4 },
      { text: 'Отлично, легко приспосабливаюсь', score: 5 },
    ],
  },
  {
    id: '13',
    text: 'Как часто вы беспокоитесь о том, что может пойти не так?',
    category: 'anxiety_management',
    options: [
      { text: 'Постоянно, это мешает жить', score: 1 },
      { text: 'Очень часто, много тревожных мыслей', score: 2 },
      { text: 'Иногда, периодически беспокоюсь', score: 3 },
      { text: 'Редко, только в серьезных ситуациях', score: 4 },
      { text: 'Практически никогда', score: 5 },
    ],
  },
  {
    id: '14',
    text: 'Насколько предсказуемо ваше эмоциональное состояние для окружающих?',
    category: 'mood_stability',
    options: [
      { text: 'Очень непредсказуемо, постоянные перепады', score: 1 },
      { text: 'Непредсказуемо, часто меняется', score: 2 },
      { text: 'Средне, иногда сюрпризы', score: 3 },
      { text: 'Довольно предсказуемо', score: 4 },
      { text: 'Очень стабильно и предсказуемо', score: 5 },
    ],
  },
  {
    id: '15',
    text: 'Как вы справляетесь с одновременным давлением из разных источников?',
    category: 'stress_response',
    options: [
      { text: 'Очень плохо, полностью теряю контроль', score: 1 },
      { text: 'Плохо, становлюсь очень напряженным', score: 2 },
      { text: 'Средне, с трудом но справляюсь', score: 3 },
      { text: 'Хорошо, умею расставлять приоритеты', score: 4 },
      { text: 'Отлично, эффективно управляю нагрузкой', score: 5 },
    ],
  },
  {
    id: '16',
    text: 'Насколько сильно влияют на вас негативные новости или события в мире?',
    category: 'emotional_regulation',
    options: [
      { text: 'Очень сильно, погружаюсь в депрессию', score: 1 },
      { text: 'Сильно, долго не могу успокоиться', score: 2 },
      { text: 'Средне, расстраиваюсь но справляюсь', score: 3 },
      { text: 'Слабо, могу дистанцироваться', score: 4 },
      { text: 'Почти не влияют, сохраняю равновесие', score: 5 },
    ],
  },
  {
    id: '17',
    text: 'Как быстро вы восстанавливаете энергию после стрессовых ситуаций?',
    category: 'resilience',
    options: [
      { text: 'Очень медленно, недели или месяцы', score: 1 },
      { text: 'Медленно, несколько дней', score: 2 },
      { text: 'Средне, день-два', score: 3 },
      { text: 'Быстро, несколько часов', score: 4 },
      { text: 'Очень быстро, практически сразу', score: 5 },
    ],
  },
  {
    id: '18',
    text: 'Как часто вы чувствуете, что не можете справиться с ежедневными задачами?',
    category: 'anxiety_management',
    options: [
      { text: 'Очень часто, почти каждый день', score: 1 },
      { text: 'Часто, несколько раз в неделю', score: 2 },
      { text: 'Иногда, в сложные периоды', score: 3 },
      { text: 'Редко, только при перегрузке', score: 4 },
      { text: 'Практически никогда', score: 5 },
    ],
  },
  {
    id: '19',
    text: 'Насколько стабильно ваше настроение в течение недели?',
    category: 'mood_stability',
    options: [
      { text: 'Очень нестабильно, как американские горки', score: 1 },
      { text: 'Нестабильно, часто меняется', score: 2 },
      { text: 'Средне, бывают колебания', score: 3 },
      { text: 'Довольно стабильно, небольшие колебания', score: 4 },
      { text: 'Очень стабильно, практически не меняется', score: 5 },
    ],
  },
  {
    id: '20',
    text: 'Как вы справляетесь с ситуациями, когда нужно принимать решения под давлением?',
    category: 'stress_response',
    options: [
      { text: 'Очень плохо, паникую и не могу думать', score: 1 },
      { text: 'Плохо, сильно нервничаю', score: 2 },
      { text: 'Средне, справляюсь с трудом', score: 3 },
      { text: 'Хорошо, могу сосредоточиться', score: 4 },
      { text: 'Отлично, работаю лучше под давлением', score: 5 },
    ],
  },
];

export const calculateEmotionalStabilityResult = (
  answers: Record<string, number>
): EmotionalStabilityResult => {
  const total_score = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((total_score - 20) / 80) * 100);

  // Подсчет баллов по категориям
  const category_scores = {
    stress_response: 0,
    emotional_regulation: 0,
    resilience: 0,
    anxiety_management: 0,
    mood_stability: 0,
  };

  const categoryCount = {
    stress_response: 0,
    emotional_regulation: 0,
    resilience: 0,
    anxiety_management: 0,
    mood_stability: 0,
  };

  emotionalStabilityQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer !== undefined) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям (средний балл * 20)
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
  });

  let overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  let title: string;
  let description: string;
  let strengths: string[];
  let challenges: string[];
  let stress_symptoms: string[];
  let lifestyle_recommendations: string[];
  let professional_help: string[];
  let warning_signs: string[];

  if (total_score <= 40) {
    overall_level = 'low';
    title = 'Низкая эмоциональная стабильность';
    description =
      'У вас низкий уровень эмоциональной стабильности. Вы часто испытываете сильные эмоциональные реакции на стресс, сложно справляетесь с тревогой и имеете склонность к перепадам настроения. Это может значительно влиять на качество жизни и отношения.';
    strengths = [
      'Высокая эмоциональная чувствительность',
      'Способность глубоко переживать',
      'Потенциал для эмпатии',
      'Мотивация к изменениям',
    ];
    challenges = [
      'Частые стрессовые реакции',
      'Трудности с эмоциональной регуляцией',
      'Низкая устойчивость к неудачам',
      'Перепады настроения',
      'Высокий уровень тревожности',
    ];
    stress_symptoms = [
      'Панические атаки',
      'Хроническая тревога',
      'Депрессивные эпизоды',
      'Физические симптомы стресса',
      'Нарушения сна',
      'Проблемы с концентрацией',
    ];
    warning_signs = [
      'Мысли о самоповреждении',
      'Полная потеря контроля над эмоциями',
      'Избегание социальных контактов',
      'Злоупотребление веществами',
      'Невозможность выполнять ежедневные обязанности',
    ];
  } else if (total_score <= 55) {
    overall_level = 'below_average';
    title = 'Пониженная эмоциональная стабильность';
    description =
      'Ваша эмоциональная стабильность ниже среднего. Вы довольно часто испытываете стресс и эмоциональные колебания, но еще способны справляться с повседневными вызовами. Работа над эмоциональными навыками поможет улучшить качество жизни.';
    strengths = [
      'Эмоциональная восприимчивость',
      'Способность к сопереживанию',
      'Мотивация к самосовершенствованию',
      'Осознание своих эмоциональных паттернов',
    ];
    challenges = [
      'Периодический высокий стресс',
      'Эмоциональная нестабильность',
      'Тревожность в сложных ситуациях',
      'Медленное восстановление после неудач',
    ];
    stress_symptoms = [
      'Периодическая тревога',
      'Эмоциональное истощение',
      'Трудности со сном',
      'Раздражительность',
      'Физическое напряжение',
    ];
    warning_signs = [
      'Увеличение частоты эмоциональных срывов',
      'Избегание стрессовых ситуаций',
      'Ухудшение отношений',
      'Снижение производительности',
    ];
  } else if (total_score <= 70) {
    overall_level = 'average';
    title = 'Средняя эмоциональная стабильность';
    description =
      'У вас средний уровень эмоциональной стабильности. Вы в целом справляетесь с жизненными вызовами, но иногда можете испытывать значительный стресс. В некоторых ситуациях вам может потребоваться дополнительная поддержка.';
    strengths = [
      'Умеренная стрессоустойчивость',
      'Способность к адаптации',
      'Базовые навыки эмоциональной регуляции',
      'Способность просить помощь',
    ];
    challenges = [
      'Периодические эмоциональные колебания',
      'Стресс в сложных ситуациях',
      'Не всегда эффективная регуляция эмоций',
    ];
    stress_symptoms = [
      'Периодическое беспокойство',
      'Временное снижение настроения',
      'Легкие физические симптомы стресса',
    ];
    warning_signs = [
      'Накопление стресса без разрядки',
      'Избегание сложных решений',
      'Снижение мотивации',
    ];
  } else if (total_score <= 85) {
    overall_level = 'above_average';
    title = 'Повышенная эмоциональная стабильность';
    description =
      'У вас высокий уровень эмоциональной стабильности. Вы хорошо справляетесь со стрессом, быстро восстанавливаетесь после неудач и поддерживаете стабильное эмоциональное состояние в большинстве ситуаций.';
    strengths = [
      'Хорошая стрессоустойчивость',
      'Быстрое восстановление после неудач',
      'Стабильное настроение',
      'Эффективная эмоциональная регуляция',
      'Способность поддерживать других',
    ];
    challenges = [
      'Иногда недооценка эмоциональных потребностей других',
      'Риск эмоционального выгорания при перегрузке',
    ];
    stress_symptoms = ['Минимальные', 'Редкие эпизоды напряжения'];
    warning_signs = ['Игнорирование собственных эмоциональных потребностей'];
  } else {
    overall_level = 'high';
    title = 'Высокая эмоциональная стабильность';
    description =
      'У вас очень высокий уровень эмоциональной стабильности. Вы демонстрируете исключительную способность сохранять спокойствие под давлением, быстро адаптируетесь к изменениям и поддерживаете позитивный настрой даже в сложных ситуациях.';
    strengths = [
      'Исключительная стрессоустойчивость',
      'Быстрая адаптация к изменениям',
      'Стабильное позитивное настроение',
      'Отличная эмоциональная регуляция',
      'Способность быть опорой для других',
      'Эффективность в кризисных ситуациях',
    ];
    challenges = [
      'Возможная недооценка эмоциональных переживаний других',
      'Риск того, что другие будут перекладывать на вас ответственность',
    ];
    stress_symptoms = ['Практически отсутствуют'];
    warning_signs = ['Минимальные'];
  }

  // Общие стратегии развития
  const coping_strategies = [
    'Техники глубокого дыхания и релаксации',
    'Регулярные физические упражнения',
    'Медитация и mindfulness практики',
    'Ведение дневника эмоций',
    'Социальная поддержка и общение',
    'Здоровый сон и режим дня',
  ];

  if (overall_level === 'low' || overall_level === 'below_average') {
    coping_strategies.push(
      'Когнитивно-поведенческие техники',
      'Постепенное увеличение стрессоустойчивости',
      'Работа с негативными мыслительными паттернами'
    );
    professional_help = [
      'Психотерапия (КПТ, ДБТ)',
      'Возможна консультация психиатра',
      'Групповая терапия',
      'Тренинги по управлению стрессом',
    ];
    lifestyle_recommendations = [
      'Создание стабильного распорядка дня',
      'Ограничение стрессовых факторов',
      'Регулярные перерывы и отдых',
      'Здоровое питание',
      'Избегание алкоголя и стимуляторов',
    ];
  } else if (overall_level === 'average') {
    professional_help = [
      'Коучинг по развитию эмоциональных навыков',
      'Краткосрочная психологическая поддержка при необходимости',
    ];
    lifestyle_recommendations = [
      'Поддержание баланса работы и отдыха',
      'Развитие хобби и интересов',
      'Социальная активность',
      'Регулярные оценки стрессового уровня',
    ];
  } else {
    professional_help = ['Развитие лидерских навыков', 'Обучение менторству и поддержке других'];
    lifestyle_recommendations = [
      'Использование своих навыков для помощи другим',
      'Поддержание текущего уровня через практики',
      'Развитие эмпатии к менее стабильным людям',
    ];
  }

  // Упражнения для развития
  const development_exercises = [
    '4-7-8 дыхание для быстрого успокоения',
    'Прогрессивная мышечная релаксация',
    'Ежедневная практика благодарности',
    'Техника "STOP" (остановись, сделай вдох, наблюдай, продолжай)',
    'Ведение эмоционального дневника',
    'Практика самосострадания',
    'Визуализация успешного преодоления стресса',
  ];

  // Системы поддержки
  const support_systems = [
    'Семья и близкие друзья',
    'Профессиональные консультанты',
    'Группы поддержки',
    'Коллеги и наставники',
    'Онлайн-сообщества',
    'Службы психологической помощи',
  ];

  return {
    overall_level,
    total_score,
    percentage,
    title,
    description,
    category_scores,
    strengths,
    challenges,
    stress_symptoms,
    coping_strategies,
    lifestyle_recommendations,
    professional_help,
    development_exercises,
    warning_signs,
    support_systems,
  };
};
