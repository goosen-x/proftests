/**
 * Тест на социальный интеллект
 * Оценивает способность понимать социальные ситуации, читать эмоции и эффективно взаимодействовать с людьми
 */

export interface SocialIntelligenceQuestion {
  id: string;
  text: string;
  category:
    | 'emotion_reading'
    | 'social_cues'
    | 'empathy'
    | 'communication'
    | 'relationship_management'
    | 'social_problem_solving';
  scenario?: string;
  options: {
    text: string;
    score: number; // 1 (низкий социальный интеллект) до 5 (высокий социальный интеллект)
  }[];
}

export interface SocialIntelligenceResult {
  overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  total_score: number; // от 22 до 110
  percentage: number; // 0-100
  title: string;
  description: string;
  category_scores: {
    emotion_reading: number; // Чтение эмоций
    social_cues: number; // Понимание социальных сигналов
    empathy: number; // Эмпатия
    communication: number; // Коммуникативные навыки
    relationship_management: number; // Управление отношениями
    social_problem_solving: number; // Решение социальных проблем
  };
  strengths: string[];
  areas_for_improvement: string[];
  social_skills: string[];
  communication_tips: string[];
  relationship_advice: string[];
  professional_benefits: string[];
  development_exercises: string[];
  warning_signs: string[];
  social_situations_guide: string[];
}

export const socialIntelligenceQuestions: SocialIntelligenceQuestion[] = [
  {
    id: '1',
    text: 'Во время разговора с коллегой вы замечаете, что он часто смотрит на часы и постукивает пальцами. Что это, скорее всего, означает?',
    category: 'social_cues',
    options: [
      { text: 'Он нервничает или испытывает стресс', score: 2 },
      { text: 'Ему скучно или он торопится', score: 5 },
      { text: 'Он заинтересован в разговоре', score: 1 },
      { text: 'У него привычка так делать', score: 3 },
      { text: 'Не знаю, не обращаю внимания на такие детали', score: 1 },
    ],
  },
  {
    id: '2',
    text: 'Ваш друг рассказывает о проблемах на работе. Как лучше всего отреагировать?',
    category: 'empathy',
    options: [
      { text: 'Сразу дать советы, как решить проблему', score: 2 },
      { text: 'Выслушать и сказать, что понимаете его чувства', score: 5 },
      { text: 'Рассказать о своих похожих проблемах', score: 3 },
      { text: 'Сказать, что все не так плохо', score: 1 },
      { text: 'Перевести разговор на другую тему', score: 1 },
    ],
  },
  {
    id: '3',
    text: 'На вечеринке вы видите человека, стоящего в углу один. Что вы делаете?',
    category: 'social_problem_solving',
    options: [
      { text: 'Ничего, каждый сам выбирает, как проводить время', score: 2 },
      { text: 'Подхожу и начинаю непринужденную беседу', score: 5 },
      { text: 'Привожу его в свою компанию', score: 4 },
      { text: 'Улыбаюсь и машу рукой издалека', score: 3 },
      { text: 'Чувствую неловкость и избегаю зрительного контакта', score: 1 },
    ],
  },
  {
    id: '4',
    text: 'Когда коллега критикует вашу работу на встрече, вы:',
    category: 'communication',
    options: [
      { text: 'Защищаетесь и объясняете свою позицию', score: 2 },
      { text: 'Благодарите за обратную связь и задаете уточняющие вопросы', score: 5 },
      { text: 'Молча выслушиваете и расстраиваетесь', score: 1 },
      { text: 'Критикуете его работу в ответ', score: 1 },
      { text: 'Принимаете к сведению, но внутренне не соглашаетесь', score: 3 },
    ],
  },
  {
    id: '5',
    text: 'По выражению лица собеседника вы можете понять, что он:',
    category: 'emotion_reading',
    options: [
      { text: 'Почти всегда - хорошо читаю эмоции по лицам', score: 5 },
      { text: 'Часто - улавливаю основные эмоции', score: 4 },
      { text: 'Иногда - только очевидные проявления', score: 3 },
      { text: 'Редко - плохо разбираюсь в мимике', score: 2 },
      { text: 'Практически никогда - не обращаю внимания', score: 1 },
    ],
  },
  {
    id: '6',
    text: 'В конфликтной ситуации между двумя друзьями вы:',
    category: 'relationship_management',
    options: [
      { text: 'Остаетесь нейтральным и не вмешиваетесь', score: 3 },
      { text: 'Помогаете им найти компромисс', score: 5 },
      { text: 'Поддерживаете того, кто прав', score: 2 },
      { text: 'Избегаете общения с обеими сторонами', score: 1 },
      { text: 'Пытаетесь отвлечь их от конфликта', score: 3 },
    ],
  },
  {
    id: '7',
    text: 'Как часто люди обращаются к вам за советом в личных вопросах?',
    category: 'empathy',
    options: [
      { text: 'Очень часто - я как психолог для друзей', score: 5 },
      { text: 'Часто - ко мне идут с проблемами', score: 4 },
      { text: 'Иногда - в серьезных ситуациях', score: 3 },
      { text: 'Редко - предпочитают советоваться с другими', score: 2 },
      { text: 'Практически никогда - не знаю почему', score: 1 },
    ],
  },
  {
    id: '8',
    text: 'В новой компании вы:',
    category: 'communication',
    options: [
      { text: 'Быстро налаживаете контакт с большинством людей', score: 5 },
      { text: 'Находите несколько близких по духу людей', score: 4 },
      { text: 'Держитесь настороженно, пока не привыкну', score: 2 },
      { text: 'Ждете, пока другие проявят инициативу', score: 2 },
      { text: 'Чувствуете себя неловко и замыкаетесь', score: 1 },
    ],
  },
  {
    id: '9',
    text: 'Когда кто-то расстроен, но не говорит об этом прямо, вы:',
    category: 'emotion_reading',
    options: [
      { text: 'Сразу замечаете и мягко интересуетесь, что случилось', score: 5 },
      { text: 'Чувствуете напряжение, но не знаете, как реагировать', score: 3 },
      { text: 'Замечаете, но ждете, пока человек сам заговорит', score: 3 },
      { text: 'Не замечаю таких тонкостей', score: 1 },
      { text: 'Предпочитаю не лезть в чужие дела', score: 2 },
    ],
  },
  {
    id: '10',
    text: 'При знакомстве с новыми людьми вы обычно:',
    category: 'social_cues',
    options: [
      { text: 'Легко находите общие темы для разговора', score: 5 },
      { text: 'Внимательно слушаете и задаете вопросы', score: 4 },
      { text: 'Рассказываете о себе и своих интересах', score: 3 },
      { text: 'Чувствуете неловкость в паузах', score: 2 },
      { text: 'Испытываете стресс и говорю мало', score: 1 },
    ],
  },
  {
    id: '11',
    text: 'Ваш партнер/супруг в плохом настроении после работы. Ваши действия:',
    category: 'relationship_management',
    options: [
      { text: 'Даете ему время и пространство, потом мягко интересуетесь', score: 5 },
      { text: 'Сразу спрашиваете, что случилось', score: 3 },
      { text: 'Пытаетесь развеселить и отвлечь', score: 3 },
      { text: 'Делаете вид, что ничего не замечаю', score: 1 },
      { text: 'Расстраиваетесь, что он портит вам настроение', score: 1 },
    ],
  },
  {
    id: '12',
    text: 'В группе людей вы чаще всего:',
    category: 'social_problem_solving',
    options: [
      { text: 'Становлюсь неформальным лидером или медиатором', score: 5 },
      { text: 'Активно участвую в обсуждениях', score: 4 },
      { text: 'Слушаю больше, чем говорю', score: 3 },
      { text: 'Чувствую себя не в своей тарелке', score: 2 },
      { text: 'Стараюсь поскорее уйти', score: 1 },
    ],
  },
  {
    id: '13',
    text: 'Когда кто-то ведет себя грубо с вами, вы:',
    category: 'communication',
    options: [
      { text: 'Сохраняю спокойствие и пытаюсь деэскалировать ситуацию', score: 5 },
      { text: 'Четко обозначаю границы, но без агрессии', score: 4 },
      { text: 'Отвечаю той же монетой', score: 2 },
      { text: 'Игнорирую и ухожу', score: 3 },
      { text: 'Расстраиваюсь и долго переживаю', score: 1 },
    ],
  },
  {
    id: '14',
    text: 'Как вы понимаете, что ваша шутка была неуместной?',
    category: 'social_cues',
    options: [
      { text: 'По изменению выражения лиц и атмосферы', score: 5 },
      { text: 'Кто-то мне прямо об этом говорит', score: 2 },
      { text: 'По неловкому молчанию', score: 4 },
      { text: 'Обычно не замечаю таких вещей', score: 1 },
      { text: 'Мои шутки всегда уместны', score: 1 },
    ],
  },
  {
    id: '15',
    text: 'При работе в команде вы лучше всего:',
    category: 'relationship_management',
    options: [
      { text: 'Координируете работу и поддерживаете командный дух', score: 5 },
      { text: 'Генерируете идеи и мотивируете других', score: 4 },
      { text: 'Выполняете свою часть работы качественно', score: 3 },
      { text: 'Предпочитаю работать независимо', score: 2 },
      { text: 'Чувствую дискомфорт от групповой работы', score: 1 },
    ],
  },
  {
    id: '16',
    text: 'Вы замечаете, что коллега избегает зрительного контакта и говорит тише обычного. Ваша реакция:',
    category: 'emotion_reading',
    options: [
      { text: 'Понимаю, что что-то не так, и деликатно выясняю', score: 5 },
      { text: 'Замечаю изменения, но не знаю, как отреагировать', score: 3 },
      { text: 'Думаю, что у него просто плохой день', score: 2 },
      { text: 'Не обращаю особого внимания', score: 1 },
      { text: 'Беспокоюсь, что проблема во мне', score: 2 },
    ],
  },
  {
    id: '17',
    text: 'При первом впечатлении о человеке вы обращаете внимание на:',
    category: 'social_cues',
    options: [
      { text: 'Язык тела, мимику и общую энергетику', score: 5 },
      { text: 'Манеру речи и выбор слов', score: 4 },
      { text: 'Внешний вид и стиль одежды', score: 3 },
      { text: 'То, что человек говорит', score: 3 },
      { text: 'Не анализирую, принимаю как есть', score: 2 },
    ],
  },
  {
    id: '18',
    text: 'Когда нужно дать плохие новости, вы:',
    category: 'communication',
    options: [
      { text: 'Выбираю подходящее время и место, говорю деликатно', score: 5 },
      { text: 'Говорю прямо, но мягко', score: 4 },
      { text: 'Сообщаю факты без лишних эмоций', score: 3 },
      { text: 'Откладываю до последнего', score: 1 },
      { text: 'Прошу кого-то другого сообщить', score: 1 },
    ],
  },
  {
    id: '19',
    text: 'В споре между друзьями вы чаще всего:',
    category: 'social_problem_solving',
    options: [
      { text: 'Помогаю найти точки соприкосновения', score: 5 },
      { text: 'Выслушиваю обе стороны', score: 4 },
      { text: 'Высказываю свое мнение', score: 3 },
      { text: 'Стараюсь не вмешиваться', score: 2 },
      { text: 'Чувствую дискомфорт и ухожу', score: 1 },
    ],
  },
  {
    id: '20',
    text: 'Насколько хорошо вы чувствуете настроение в группе людей?',
    category: 'emotion_reading',
    options: [
      { text: 'Отлично - сразу считываю общую атмосферу', score: 5 },
      { text: 'Хорошо - понимаю основные эмоциональные течения', score: 4 },
      { text: 'Средне - замечаю очевидные вещи', score: 3 },
      { text: 'Плохо - часто не понимаю, что происходит', score: 2 },
      { text: 'Очень плохо - сосредоточен на себе', score: 1 },
    ],
  },
  {
    id: '21',
    text: 'Ваша способность влиять на мнение других людей:',
    category: 'communication',
    options: [
      { text: 'Высокая - умею убеждать и мотивировать', score: 5 },
      { text: 'Хорошая - могу повлиять в знакомых вопросах', score: 4 },
      { text: 'Средняя - иногда получается', score: 3 },
      { text: 'Низкая - люди редко меняют мнение из-за меня', score: 2 },
      { text: 'Очень низкая - предпочитаю не пытаться', score: 1 },
    ],
  },
  {
    id: '22',
    text: 'Как вы поступаете, если чувствуете, что обидели человека?',
    category: 'relationship_management',
    options: [
      { text: 'Сразу искренне извиняюсь и выясняю, как исправить ситуацию', score: 5 },
      { text: 'Извиняюсь, когда улягутся эмоции', score: 4 },
      { text: 'Жду, пока человек сам поднимет эту тему', score: 2 },
      { text: 'Считаю, что он сам должен сказать, если обиделся', score: 1 },
      { text: 'Обычно не замечаю, что кого-то обидел', score: 1 },
    ],
  },
];

export const calculateSocialIntelligenceResult = (
  answers: Record<string, number>
): SocialIntelligenceResult => {
  const total_score = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((total_score - 22) / 88) * 100);

  // Подсчет баллов по категориям
  const category_scores = {
    emotion_reading: 0,
    social_cues: 0,
    empathy: 0,
    communication: 0,
    relationship_management: 0,
    social_problem_solving: 0,
  };

  const categoryCount = {
    emotion_reading: 0,
    social_cues: 0,
    empathy: 0,
    communication: 0,
    relationship_management: 0,
    social_problem_solving: 0,
  };

  socialIntelligenceQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer !== undefined) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям (средний балл * 20)
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
  });

  let overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  let title: string;
  let description: string;
  let strengths: string[];
  let areas_for_improvement: string[];
  let relationship_advice: string[];
  let professional_benefits: string[];
  let development_exercises: string[];
  let warning_signs: string[];

  if (total_score <= 44) {
    overall_level = 'low';
    title = 'Низкий социальный интеллект';
    description =
      'Вам может быть сложно понимать социальные ситуации, читать эмоции других людей и эффективно взаимодействовать в группе. Это нормально, и эти навыки можно развить с практикой и осознанными усилиями.';
    strengths = [
      'Честность и прямолинейность',
      'Сосредоточенность на задачах',
      'Независимость в суждениях',
      'Потенциал для развития',
    ];
    areas_for_improvement = [
      'Чтение эмоций и социальных сигналов',
      'Активное слушание',
      'Эмпатия и понимание чужих переживаний',
      'Навыки межличностного общения',
      'Управление конфликтами',
    ];
    warning_signs = [
      'Частые недопонимания с окружающими',
      'Трудности в командной работе',
      'Проблемы в личных отношениях',
      'Социальная изоляция',
      'Низкая самооценка в социальных ситуациях',
    ];
  } else if (total_score <= 66) {
    overall_level = 'below_average';
    title = 'Социальный интеллект ниже среднего';
    description =
      'У вас есть базовые социальные навыки, но иногда возникают трудности в понимании более сложных социальных ситуаций. Целенаправленная работа над развитием эмоционального интеллекта принесет хорошие результаты.';
    strengths = [
      'Базовое понимание социальных норм',
      'Способность к обучению',
      'Желание улучшить отношения',
      'Искренность в общении',
    ];
    areas_for_improvement = [
      'Понимание невербальных сигналов',
      'Эмпатические реакции',
      'Инициатива в общении',
      'Разрешение конфликтов',
    ];
    warning_signs = [
      'Периодические социальные неловкости',
      'Трудности в новых коллективах',
      'Неуверенность в социальных ситуациях',
    ];
  } else if (total_score <= 88) {
    overall_level = 'average';
    title = 'Средний социальный интеллект';
    description =
      'У вас нормальный уровень социальных навыков. Вы способны эффективно взаимодействовать с большинством людей в обычных ситуациях, но можете испытывать затруднения в более сложных или напряженных социальных контекстах.';
    strengths = [
      'Адекватное понимание базовых эмоций',
      'Способность к эмпатии в знакомых ситуациях',
      'Умение поддерживать разговор',
      'Понимание основных социальных правил',
    ];
    areas_for_improvement = [
      'Чтение тонких социальных сигналов',
      'Навыки влияния и убеждения',
      'Лидерские качества в группе',
    ];
    warning_signs = [
      'Трудности в стрессовых социальных ситуациях',
      'Недопонимания с незнакомыми людьми',
    ];
  } else if (total_score <= 99) {
    overall_level = 'above_average';
    title = 'Социальный интеллект выше среднего';
    description =
      'У вас хорошо развитые социальные навыки. Вы легко понимаете эмоции других людей, эффективно общаетесь и способны успешно навигировать в сложных социальных ситуациях. Люди часто чувствуют себя комфортно в вашем обществе.';
    strengths = [
      'Хорошее понимание эмоций и мотивов людей',
      'Развитая эмпатия',
      'Эффективные коммуникативные навыки',
      'Способность к медиации конфликтов',
      'Лидерские качества',
    ];
    areas_for_improvement = [
      'Работа с очень сложными межличностными конфликтами',
      'Развитие навыков в стрессовых ситуациях',
    ];
    warning_signs = ['Минимальные'];
  } else {
    overall_level = 'high';
    title = 'Высокий социальный интеллект';
    description =
      'У вас исключительно высокий уровень социального интеллекта. Вы интуитивно понимаете людей, мастерски читаете социальные ситуации и способны эффективно влиять на групповую динамику. Вы естественный лидер и медиатор.';
    strengths = [
      'Исключительная способность читать эмоции',
      'Высокая эмпатия и понимание мотивов',
      'Мастерство в межличностном общении',
      'Естественные лидерские способности',
      'Талант к разрешению конфликтов',
      'Способность мотивировать и вдохновлять других',
    ];
    areas_for_improvement = [
      'Возможная тенденция к манипулированию',
      'Эмоциональное выгорание от постоянной помощи другим',
    ];
    warning_signs = ['Практически отсутствуют'];
  }

  // Общие социальные навыки
  const social_skills = [
    'Активное слушание',
    'Чтение языка тела',
    'Эмпатическое реагирование',
    'Управление конфликтами',
    'Командная работа',
    'Публичные выступления',
    'Нетворкинг и построение связей',
    'Влияние и убеждение',
  ];

  // Советы по коммуникации
  const communication_tips = [
    'Поддерживайте зрительный контакт',
    'Используйте открытый язык тела',
    'Задавайте открытые вопросы',
    'Практикуйте активное слушание',
    'Адаптируйте стиль общения под собеседника',
    'Будьте искренними в выражении эмоций',
    'Развивайте навыки невербального общения',
  ];

  if (overall_level === 'low' || overall_level === 'below_average') {
    relationship_advice = [
      'Начните с одного близкого человека и практикуйте открытое общение',
      'Учитесь задавать вопросы о чувствах и переживаниях',
      'Обращайте больше внимания на невербальные сигналы',
      'Присоединяйтесь к группам по интересам для практики',
      'Читайте книги по эмоциональному интеллекту',
    ];

    professional_benefits = [
      'Улучшение командной работы',
      'Повышение эффективности переговоров',
      'Лучшее понимание потребностей клиентов',
      'Развитие лидерских навыков',
    ];

    development_exercises = [
      'Наблюдение за людьми в общественных местах',
      'Практика определения эмоций по фотографиям',
      'Ведение дневника социальных взаимодействий',
      'Упражнения на активное слушание',
      'Ролевые игры с друзьями или коучем',
      'Медитация для развития эмпатии',
    ];
  } else if (overall_level === 'average') {
    relationship_advice = [
      'Развивайте более глубокие связи с близкими',
      'Практикуйте сложные разговоры',
      'Учитесь давать и получать обратную связь',
      'Работайте над конфликтными ситуациями',
    ];

    professional_benefits = [
      'Карьерный рост через лидерство',
      'Эффективное управление командой',
      'Успешные переговоры и продажи',
      'Наставничество и развитие других',
    ];

    development_exercises = [
      'Тренинги по лидерству',
      'Практика публичных выступлений',
      'Работа с коучем по развитию soft skills',
      'Участие в групповых проектах',
    ];
  } else {
    relationship_advice = [
      'Используйте навыки для помощи другим',
      'Развивайте глубокие, значимые отношения',
      'Будьте ментором для менее социально развитых людей',
      'Продолжайте изучать тонкости человеческой психологии',
    ];

    professional_benefits = [
      'Естественное лидерство',
      'Карьера в HR, коучинге, консультировании',
      'Успех в переговорах и дипломатии',
      'Способность создавать сильные команды',
    ];

    development_exercises = [
      'Изучение психологии и конфликтологии',
      'Менторство и коучинг других',
      'Участие в сложных переговорах',
      'Развитие эмоционального интеллекта на экспертном уровне',
    ];
  }

  // Руководство по социальным ситуациям
  const social_situations_guide = [
    'Первые встречи: будьте открытыми и любопытными',
    'Конфликты: слушайте все стороны перед выводами',
    'Групповая работа: сосредоточьтесь на общих целях',
    'Неловкие ситуации: используйте юмор и честность',
    'Поддержка друзей: иногда достаточно просто выслушать',
    'Нетворкинг: фокусируйтесь на помощи другим, а не на личной выгоде',
  ];

  return {
    overall_level,
    total_score,
    percentage,
    title,
    description,
    category_scores,
    strengths,
    areas_for_improvement,
    social_skills,
    communication_tips,
    relationship_advice,
    professional_benefits,
    development_exercises,
    warning_signs,
    social_situations_guide,
  };
};
