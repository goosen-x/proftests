/**
 * Тест на баланс работы и жизни
 * Оценивает гармонию между профессиональной деятельностью и личной жизнью
 */

export interface WorkLifeBalanceQuestion {
  id: string;
  text: string;
  category: 'work_pressure' | 'personal_time' | 'health' | 'relationships' | 'boundaries';
  options: {
    text: string;
    score: number; // 1 (плохой баланс) до 5 (отличный баланс)
  }[];
}

export interface WorkLifeBalanceResult {
  overall_score: number; // от 20 до 100
  percentage: number; // 0-100
  level: 'poor' | 'needs_improvement' | 'moderate' | 'good' | 'excellent';
  title: string;
  description: string;
  category_scores: {
    work_pressure: number;
    personal_time: number;
    health: number;
    relationships: number;
    boundaries: number;
  };
  strengths: string[];
  problem_areas: string[];
  recommendations: string[];
  immediate_actions: string[];
  long_term_strategies: string[];
  warning_signs: string[];
}

export const workLifeBalanceQuestions: WorkLifeBalanceQuestion[] = [
  {
    id: '1',
    text: 'Как часто вы работаете сверхурочно?',
    category: 'work_pressure',
    options: [
      { text: 'Ежедневно, это стало нормой', score: 1 },
      { text: 'Несколько раз в неделю', score: 2 },
      { text: 'Иногда, при необходимости', score: 3 },
      { text: 'Редко, только в исключительных случаях', score: 4 },
      { text: 'Практически никогда', score: 5 }
    ]
  },
  {
    id: '2',
    text: 'Сколько времени в день вы посвящаете только себе?',
    category: 'personal_time',
    options: [
      { text: 'Совсем нет личного времени', score: 1 },
      { text: 'Менее 30 минут', score: 2 },
      { text: '30 минут - 1 час', score: 3 },
      { text: '1-2 часа', score: 4 },
      { text: 'Более 2 часов', score: 5 }
    ]
  },
  {
    id: '3',
    text: 'Как часто вы думаете о работе в выходные дни?',
    category: 'boundaries',
    options: [
      { text: 'Постоянно, не могу отключиться', score: 1 },
      { text: 'Очень часто', score: 2 },
      { text: 'Иногда', score: 3 },
      { text: 'Редко', score: 4 },
      { text: 'Практически никогда', score: 5 }
    ]
  },
  {
    id: '4',
    text: 'Насколько качественно вы спите?',
    category: 'health',
    options: [
      { text: 'Очень плохо, постоянная бессонница', score: 1 },
      { text: 'Плохо, часто просыпаюсь', score: 2 },
      { text: 'Средне, иногда проблемы со сном', score: 3 },
      { text: 'Хорошо, обычно сплю спокойно', score: 4 },
      { text: 'Отлично, глубокий здоровый сон', score: 5 }
    ]
  },
  {
    id: '5',
    text: 'Как часто вы проводите качественное время с семьей/друзьями?',
    category: 'relationships',
    options: [
      { text: 'Почти никогда, нет времени', score: 1 },
      { text: 'Очень редко', score: 2 },
      { text: 'Иногда, но недостаточно', score: 3 },
      { text: 'Регулярно, несколько раз в неделю', score: 4 },
      { text: 'Ежедневно уделяю время близким', score: 5 }
    ]
  },
  {
    id: '6',
    text: 'Насколько легко вам сказать "нет" дополнительным рабочим задачам?',
    category: 'boundaries',
    options: [
      { text: 'Очень сложно, соглашаюсь на всё', score: 1 },
      { text: 'Сложно, часто соглашаюсь против воли', score: 2 },
      { text: 'Средне, зависит от ситуации', score: 3 },
      { text: 'Довольно легко защищаю свои границы', score: 4 },
      { text: 'Легко устанавливаю и соблюдаю границы', score: 5 }
    ]
  },
  {
    id: '7',
    text: 'Как часто вы занимаетесь физическими упражнениями?',
    category: 'health',
    options: [
      { text: 'Никогда, нет времени', score: 1 },
      { text: 'Очень редко', score: 2 },
      { text: '1-2 раза в неделю', score: 3 },
      { text: '3-4 раза в неделю', score: 4 },
      { text: 'Ежедневно или почти ежедневно', score: 5 }
    ]
  },
  {
    id: '8',
    text: 'Насколько удовлетворены ваши близкие вашим участием в их жизни?',
    category: 'relationships',
    options: [
      { text: 'Очень недовольны, есть серьезные проблемы', score: 1 },
      { text: 'Недовольны, часто жалуются', score: 2 },
      { text: 'Средне, иногда выражают недовольство', score: 3 },
      { text: 'В основном довольны', score: 4 },
      { text: 'Полностью удовлетворены моим участием', score: 5 }
    ]
  },
  {
    id: '9',
    text: 'Как часто вы проверяете рабочую почту/сообщения вне рабочих часов?',
    category: 'boundaries',
    options: [
      { text: 'Постоянно, круглосуточно', score: 1 },
      { text: 'Несколько раз вечером и в выходные', score: 2 },
      { text: 'Иногда, при необходимости', score: 3 },
      { text: 'Редко, только в экстренных случаях', score: 4 },
      { text: 'Никогда вне рабочего времени', score: 5 }
    ]
  },
  {
    id: '10',
    text: 'Насколько часто вы чувствуете усталость и выгорание?',
    category: 'health',
    options: [
      { text: 'Постоянно истощен', score: 1 },
      { text: 'Часто чувствую усталость', score: 2 },
      { text: 'Иногда устаю больше обычного', score: 3 },
      { text: 'Редко чувствую сильную усталость', score: 4 },
      { text: 'Полон энергии и мотивации', score: 5 }
    ]
  },
  {
    id: '11',
    text: 'Сколько отпускных дней вы фактически используете в год?',
    category: 'personal_time',
    options: [
      { text: 'Почти не беру отпуск', score: 1 },
      { text: 'Меньше половины положенного', score: 2 },
      { text: 'Около половины', score: 3 },
      { text: 'Большую часть положенного отпуска', score: 4 },
      { text: 'Полностью использую весь отпуск', score: 5 }
    ]
  },
  {
    id: '12',
    text: 'Как часто вы занимаетесь хобби или увлечениями?',
    category: 'personal_time',
    options: [
      { text: 'Никогда, нет времени на хобби', score: 1 },
      { text: 'Очень редко', score: 2 },
      { text: 'Иногда, когда есть свободное время', score: 3 },
      { text: 'Регулярно, несколько раз в неделю', score: 4 },
      { text: 'Ежедневно уделяю время увлечениям', score: 5 }
    ]
  },
  {
    id: '13',
    text: 'Насколько сильно рабочий стресс влияет на вашу личную жизнь?',
    category: 'work_pressure',
    options: [
      { text: 'Полностью поглощает личную жизнь', score: 1 },
      { text: 'Сильно влияет, портит настроение дома', score: 2 },
      { text: 'Умеренно влияет', score: 3 },
      { text: 'Слабо влияет, могу отключиться', score: 4 },
      { text: 'Практически не влияет', score: 5 }
    ]
  },
  {
    id: '14',
    text: 'Как часто вы едите нормальную домашнюю еду (не фастфуд/перекусы)?',
    category: 'health',
    options: [
      { text: 'Почти никогда, питаюсь на бегу', score: 1 },
      { text: 'Редко, в основном быстрая еда', score: 2 },
      { text: 'Иногда готовлю дома', score: 3 },
      { text: 'Часто ем домашнюю еду', score: 4 },
      { text: 'Ежедневно питаюсь полноценно', score: 5 }
    ]
  },
  {
    id: '15',
    text: 'Насколько удовлетворены вы текущим балансом работы и жизни?',
    category: 'personal_time',
    options: [
      { text: 'Крайне неудовлетворен', score: 1 },
      { text: 'Неудовлетворен', score: 2 },
      { text: 'Средне, есть что улучшать', score: 3 },
      { text: 'В основном удовлетворен', score: 4 },
      { text: 'Полностью удовлетворен балансом', score: 5 }
    ]
  },
  {
    id: '16',
    text: 'Как часто вы берете больничный из-за стресса или переутомления?',
    category: 'work_pressure',
    options: [
      { text: 'Часто, несколько раз в месяц', score: 1 },
      { text: 'Иногда, раз в месяц-два', score: 2 },
      { text: 'Редко, несколько раз в год', score: 3 },
      { text: 'Очень редко', score: 4 },
      { text: 'Никогда', score: 5 }
    ]
  },
  {
    id: '17',
    text: 'Насколько легко вам расслабиться после работы?',
    category: 'boundaries',
    options: [
      { text: 'Очень сложно, постоянно напряжен', score: 1 },
      { text: 'Сложно, нужно много времени', score: 2 },
      { text: 'Средне, зависит от дня', score: 3 },
      { text: 'Довольно легко переключаюсь', score: 4 },
      { text: 'Легко расслабляюсь и отключаюсь', score: 5 }
    ]
  },
  {
    id: '18',
    text: 'Как часто вы отменяете личные планы из-за работы?',
    category: 'work_pressure',
    options: [
      { text: 'Постоянно, работа всегда приоритет', score: 1 },
      { text: 'Часто, несколько раз в неделю', score: 2 },
      { text: 'Иногда, раз в неделю', score: 3 },
      { text: 'Редко, только в крайних случаях', score: 4 },
      { text: 'Практически никогда', score: 5 }
    ]
  },
  {
    id: '19',
    text: 'Насколько поддерживают вас коллеги/руководство в вопросах баланса?',
    category: 'work_pressure',
    options: [
      { text: 'Совсем не поддерживают, давят', score: 1 },
      { text: 'Слабо поддерживают', score: 2 },
      { text: 'Нейтрально относятся', score: 3 },
      { text: 'В основном поддерживают', score: 4 },
      { text: 'Полностью поддерживают баланс', score: 5 }
    ]
  },
  {
    id: '20',
    text: 'Как часто вы чувствуете радость и удовлетворение от жизни?',
    category: 'personal_time',
    options: [
      { text: 'Практически никогда', score: 1 },
      { text: 'Редко, только по особым случаям', score: 2 },
      { text: 'Иногда, зависит от обстоятельств', score: 3 },
      { text: 'Часто, регулярно получаю удовольствие', score: 4 },
      { text: 'Ежедневно чувствую радость жизни', score: 5 }
    ]
  }
];

export const calculateWorkLifeBalanceResult = (answers: Record<string, number>): WorkLifeBalanceResult => {
  const totalScore = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((totalScore - 20) / 80) * 100);
  
  // Подсчет баллов по категориям
  const category_scores = {
    work_pressure: 0,
    personal_time: 0,
    health: 0,
    relationships: 0,
    boundaries: 0
  };

  const categoryCount = {
    work_pressure: 0,
    personal_time: 0,
    health: 0,
    relationships: 0,
    boundaries: 0
  };

  workLifeBalanceQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям (средний балл * 20)
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
  });

  let level: 'poor' | 'needs_improvement' | 'moderate' | 'good' | 'excellent';
  let title: string;
  let description: string;
  let strengths: string[];
  let problem_areas: string[];
  let recommendations: string[];
  let immediate_actions: string[];
  let long_term_strategies: string[];
  let warning_signs: string[];

  if (totalScore <= 40) {
    level = 'poor';
    title = 'Критический дисбаланс';
    description = 'У вас серьезные проблемы с балансом работы и жизни. Работа полностью поглощает вашу личную жизнь, что может привести к выгоранию, проблемам со здоровьем и разрушению отношений. Необходимы кардинальные изменения.';
    strengths = ['Высокая вовлеченность в работу', 'Ответственный подход к обязанностям'];
    problem_areas = [
      'Полное отсутствие личного времени',
      'Игнорирование собственных потребностей',
      'Разрушение отношений с близкими',
      'Серьезные проблемы со здоровьем',
      'Отсутствие границ между работой и жизнью'
    ];
    warning_signs = [
      'Хроническая усталость и бессонница',
      'Частые болезни и стресс',
      'Конфликты в семье',
      'Потеря интереса к жизни',
      'Симптомы выгорания'
    ];
  } else if (totalScore <= 55) {
    level = 'needs_improvement';
    title = 'Нуждается в улучшении';
    description = 'Ваш баланс работы и жизни нарушен. Работа занимает слишком много места в вашей жизни, оставляя мало времени для личных потребностей и отношений. Пора принимать меры для восстановления баланса.';
    strengths = ['Осознание проблемы', 'Готовность к изменениям', 'Профессиональная компетентность'];
    problem_areas = [
      'Недостаток личного времени',
      'Постоянный рабочий стресс',
      'Ухудшение отношений',
      'Проблемы со здоровьем',
      'Слабые границы'
    ];
    warning_signs = [
      'Регулярная переработка',
      'Усталость в выходные',
      'Жалобы близких',
      'Проблемы со сном',
      'Снижение мотивации'
    ];
  } else if (totalScore <= 70) {
    level = 'moderate';
    title = 'Умеренный баланс';
    description = 'У вас средний уровень баланса работы и жизни. Есть как положительные моменты, так и области для улучшения. С небольшими корректировками вы можете значительно улучшить свое качество жизни.';
    strengths = ['Понимание важности баланса', 'Некоторые здоровые привычки', 'Способность к изменениям'];
    problem_areas = [
      'Периодические переработки',
      'Недостаточно времени на хобби',
      'Иногда игнорирование здоровья',
      'Непостоянные границы'
    ];
    warning_signs = [
      'Периодическая усталость',
      'Пропуск личных планов',
      'Редкое использование отпусков',
      'Стресс влияет на сон'
    ];
  } else if (totalScore <= 85) {
    level = 'good';
    title = 'Хороший баланс';
    description = 'У вас хороший баланс между работой и личной жизнью. Вы понимаете важность границ и в основном их соблюдаете. Есть лишь незначительные области для улучшения.';
    strengths = [
      'Четкие границы между работой и жизнью',
      'Регулярное время для себя',
      'Хорошие отношения с близкими',
      'Забота о здоровье',
      'Умение сказать "нет"'
    ];
    problem_areas = [
      'Иногда нарушение границ',
      'Периодический стресс от работы',
      'Можно больше времени уделить хобби'
    ];
    warning_signs = ['Редкие эпизоды переработки', 'Иногда пропуск тренировок'];
  } else {
    level = 'excellent';
    title = 'Отличный баланс';
    description = 'Поздравляем! У вас отличный баланс работы и жизни. Вы мастерски управляете своим временем, поддерживаете здоровые границы и находите гармонию во всех сферах жизни.';
    strengths = [
      'Идеальные границы работы и жизни',
      'Регулярная забота о себе',
      'Крепкие отношения',
      'Отличное физическое и психическое здоровье',
      'Высокое удовлетворение жизнью',
      'Пример для других'
    ];
    problem_areas = ['Практически отсутствуют'];
    warning_signs = ['Отсутствуют'];
  }

  // Общие рекомендации на основе уровня
  if (level === 'poor' || level === 'needs_improvement') {
    recommendations = [
      'Немедленно установите четкие границы рабочего времени',
      'Научитесь говорить "нет" дополнительным задачам',
      'Запланируйте обязательное личное время каждый день',
      'Обратитесь к руководству о снижении нагрузки',
      'Рассмотрите смену работы, если изменения невозможны',
      'Начните заботиться о физическом здоровье'
    ];
    immediate_actions = [
      'Прямо сейчас запланируйте 1 час только для себя',
      'Отключите рабочие уведомления после определенного времени',
      'Поговорите с близкими о ваших проблемах',
      'Запишитесь к врачу для проверки здоровья',
      'Возьмите выходной на этой неделе'
    ];
    long_term_strategies = [
      'Развитие навыков тайм-менеджмента',
      'Изучение техник управления стрессом',
      'Поиск работы с лучшим балансом',
      'Построение системы поддержки',
      'Регулярные оценки приоритетов жизни'
    ];
  } else if (level === 'moderate') {
    recommendations = [
      'Укрепите границы между работой и личной жизнью',
      'Увеличьте время на физическую активность',
      'Планируйте и защищайте личное время',
      'Развивайте хобби и увлечения',
      'Улучшите коммуникацию с близкими'
    ];
    immediate_actions = [
      'Составьте еженедельный план личного времени',
      'Начните новое хобби или возобновите старое',
      'Запланируйте качественное время с близкими',
      'Установите лимиты на проверку рабочей почты'
    ];
    long_term_strategies = [
      'Развитие эмоционального интеллекта',
      'Построение более эффективных рабочих процессов',
      'Создание системы поддержки',
      'Регулярная оценка и корректировка баланса'
    ];
  } else {
    recommendations = [
      'Продолжайте поддерживать здоровые привычки',
      'Делитесь опытом с другими',
      'Будьте примером здорового баланса',
      'Регулярно оценивайте и корректируйте подход'
    ];
    immediate_actions = [
      'Поделитесь советами с коллегами',
      'Станьте ментором для тех, кто борется с балансом',
      'Продолжайте инвестировать в отношения'
    ];
    long_term_strategies = [
      'Поддержание текущего уровня',
      'Помощь другим в достижении баланса',
      'Адаптация к изменяющимся обстоятельствам'
    ];
  }

  return {
    overall_score: totalScore,
    percentage,
    level,
    title,
    description,
    category_scores,
    strengths,
    problem_areas,
    recommendations,
    immediate_actions,
    long_term_strategies,
    warning_signs
  };
};