/**
 * Тест на потенциал в продажах
 * Оценивает способности и склонности к успешной деятельности в сфере продаж
 */

export interface SalesPotentialQuestion {
  id: string;
  text: string;
  category:
    | 'communication'
    | 'persuasion'
    | 'resilience'
    | 'relationships'
    | 'motivation'
    | 'adaptability';
  options: {
    text: string;
    score: number; // 1 (низкий потенциал) до 5 (высокий потенциал)
  }[];
}

export interface SalesPotentialResult {
  overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  total_score: number; // от 20 до 100
  percentage: number; // 0-100
  title: string;
  description: string;
  category_scores: {
    communication: number; // Коммуникативные навыки
    persuasion: number; // Навыки убеждения
    resilience: number; // Устойчивость к отказам
    relationships: number; // Построение отношений
    motivation: number; // Мотивация к продажам
    adaptability: number; // Адаптивность
  };
  strengths: string[];
  challenges: string[];
  sales_skills: string[];
  personality_traits: string[];
  ideal_sales_types: string[];
  development_areas: string[];
  success_strategies: string[];
  training_recommendations: string[];
  career_paths: string[];
  warning_signs: string[];
}

export const salesPotentialQuestions: SalesPotentialQuestion[] = [
  {
    id: '1',
    text: 'Как вы обычно реагируете на отказ потенциального клиента?',
    category: 'resilience',
    options: [
      { text: 'Расстраиваюсь и долго переживаю', score: 1 },
      { text: 'Принимаю близко к сердцу, но стараюсь не показывать', score: 2 },
      { text: 'Немного расстраиваюсь, но быстро восстанавливаюсь', score: 3 },
      { text: 'Воспринимаю как обычную часть работы', score: 4 },
      { text: 'Использую как возможность узнать больше и улучшить подход', score: 5 },
    ],
  },
  {
    id: '2',
    text: 'Насколько легко вам установить контакт с незнакомыми людьми?',
    category: 'communication',
    options: [
      { text: 'Очень сложно, избегаю таких ситуаций', score: 1 },
      { text: 'Сложно, нужно время чтобы освоиться', score: 2 },
      { text: 'Средне, зависит от ситуации и настроения', score: 3 },
      { text: 'Довольно легко, но требует некоторых усилий', score: 4 },
      { text: 'Очень легко, получаю удовольствие от знакомств', score: 5 },
    ],
  },
  {
    id: '3',
    text: 'Как вы относитесь к необходимости убеждать других?',
    category: 'persuasion',
    options: [
      { text: 'Неудобно, предпочитаю избегать', score: 1 },
      { text: 'Делаю только когда необходимо', score: 2 },
      { text: 'Нормально, но не всегда получается', score: 3 },
      { text: 'Уверенно справляюсь с этой задачей', score: 4 },
      { text: 'Люблю и умею убеждать, это меня вдохновляет', score: 5 },
    ],
  },
  {
    id: '4',
    text: 'Что вас больше всего мотивирует в работе?',
    category: 'motivation',
    options: [
      { text: 'Стабильность и предсказуемость', score: 1 },
      { text: 'Комфортная атмосфера в коллективе', score: 2 },
      { text: 'Интересные задачи и профессиональный рост', score: 3 },
      { text: 'Признание достижений и возможность влиять', score: 4 },
      { text: 'Высокий доход и соревнование с другими', score: 5 },
    ],
  },
  {
    id: '5',
    text: 'Как вы ведете себя на вечеринке или корпоративном мероприятии?',
    category: 'relationships',
    options: [
      { text: 'Держусь в стороне, общаюсь с теми, кого знаю', score: 1 },
      { text: 'Общаюсь в небольшой группе знакомых', score: 2 },
      { text: 'Участвую в общих разговорах, но не инициирую', score: 3 },
      { text: 'Активно знакомлюсь и поддерживаю разговоры', score: 4 },
      { text: 'Становлюсь центром внимания, легко завожу новые знакомства', score: 5 },
    ],
  },
  {
    id: '6',
    text: 'Как быстро вы адаптируетесь к изменению условий работы?',
    category: 'adaptability',
    options: [
      { text: 'Очень тяжело, нужно много времени', score: 1 },
      { text: 'Сложно, но со временем привыкаю', score: 2 },
      { text: 'Нормально адаптируюсь при поддержке', score: 3 },
      { text: 'Довольно быстро приспосабливаюсь', score: 4 },
      { text: 'Легко и быстро, изменения меня мотивируют', score: 5 },
    ],
  },
  {
    id: '7',
    text: 'Насколько хорошо вы чувствуете настроение и потребности собеседника?',
    category: 'communication',
    options: [
      { text: 'Плохо, часто не понимаю реакции людей', score: 1 },
      { text: 'Иногда улавливаю, но не всегда правильно', score: 2 },
      { text: 'В целом понимаю основные эмоции', score: 3 },
      { text: 'Хорошо чувствую и адаптируюсь', score: 4 },
      { text: 'Отлично читаю людей и использую это в общении', score: 5 },
    ],
  },
  {
    id: '8',
    text: 'Как вы относитесь к соревнованию с коллегами?',
    category: 'motivation',
    options: [
      { text: 'Избегаю, предпочитаю сотрудничество', score: 1 },
      { text: 'Участвую неохотно, если требуется', score: 2 },
      { text: 'Нормально отношусь, но не стремлюсь', score: 3 },
      { text: 'Мотивирует, стараюсь быть в лидерах', score: 4 },
      { text: 'Обожаю соревнования, стремлюсь быть первым', score: 5 },
    ],
  },
  {
    id: '9',
    text: 'Что вы делаете, когда клиент сомневается в покупке?',
    category: 'persuasion',
    options: [
      { text: 'Не настаиваю, говорю подумать', score: 1 },
      { text: 'Даю дополнительную информацию и жду', score: 2 },
      { text: 'Отвечаю на вопросы и объясняю преимущества', score: 3 },
      { text: 'Выясняю конкретные возражения и работаю с ними', score: 4 },
      { text: 'Использую техники убеждения и создаю срочность', score: 5 },
    ],
  },
  {
    id: '10',
    text: 'Как долго вы можете сохранять энтузиазм при сложных переговорах?',
    category: 'resilience',
    options: [
      { text: 'Быстро теряю интерес и энергию', score: 1 },
      { text: 'Хватает на короткое время', score: 2 },
      { text: 'Могу поддерживать, но с усилием', score: 3 },
      { text: 'Достаточно долго, особенно если вижу прогресс', score: 4 },
      { text: 'Чем сложнее, тем больше азарта и энергии', score: 5 },
    ],
  },
  {
    id: '11',
    text: 'Насколько комфортно вам говорить о деньгах и ценах?',
    category: 'communication',
    options: [
      { text: 'Очень неловко, избегаю этих тем', score: 1 },
      { text: 'Неудобно, но делаю когда нужно', score: 2 },
      { text: 'Нормально, но иногда чувствую напряжение', score: 3 },
      { text: 'Комфортно обсуждаю финансовые вопросы', score: 4 },
      { text: 'Легко и уверенно говорю о ценности и цене', score: 5 },
    ],
  },
  {
    id: '12',
    text: 'Как вы строите долгосрочные отношения с клиентами?',
    category: 'relationships',
    options: [
      { text: 'С трудом, плохо поддерживаю контакты', score: 1 },
      { text: 'Пытаюсь, но часто забываю', score: 2 },
      { text: 'Поддерживаю основные контакты', score: 3 },
      { text: 'Регулярно поддерживаю связь и слежу за потребностями', score: 4 },
      { text: 'Превращаю клиентов в партнеров и друзей', score: 5 },
    ],
  },
  {
    id: '13',
    text: 'Как вы реагируете на агрессивного или недовольного клиента?',
    category: 'resilience',
    options: [
      { text: 'Теряюсь, принимаю на личный счет', score: 1 },
      { text: 'Расстраиваюсь, но стараюсь не показывать', score: 2 },
      { text: 'Остаюсь вежливым, но чувствую дискомфорт', score: 3 },
      { text: 'Сохраняю спокойствие и работаю с ситуацией', score: 4 },
      { text: 'Воспринимаю как вызов, нахожу способ успокоить', score: 5 },
    ],
  },
  {
    id: '14',
    text: 'Что вы чувствуете, когда нужно обзвонить список потенциальных клиентов?',
    category: 'motivation',
    options: [
      { text: 'Страх и желание отложить на потом', score: 1 },
      { text: 'Неохота, делаю через силу', score: 2 },
      { text: 'Нейтрально, как обычную работу', score: 3 },
      { text: 'С интересом, каждый звонок - возможность', score: 4 },
      { text: 'С энтузиазмом, люблю поиск новых клиентов', score: 5 },
    ],
  },
  {
    id: '15',
    text: 'Насколько хорошо вы презентуете продукт или услугу?',
    category: 'persuasion',
    options: [
      { text: 'Плохо, путаюсь и забываю детали', score: 1 },
      { text: 'Справляюсь, но без энтузиазма', score: 2 },
      { text: 'Нормально рассказываю основное', score: 3 },
      { text: 'Уверенно презентую, подстраиваюсь под аудиторию', score: 4 },
      { text: 'Отлично продаю идею, вдохновляю и убеждаю', score: 5 },
    ],
  },
  {
    id: '16',
    text: 'Как вы относитесь к работе с возражениями клиентов?',
    category: 'adaptability',
    options: [
      { text: 'Избегаю, соглашаюсь с клиентом', score: 1 },
      { text: 'Неудобно, но стараюсь отвечать', score: 2 },
      { text: 'Нормально работаю с основными возражениями', score: 3 },
      { text: 'Уверенно отрабатываю, вижу возможности', score: 4 },
      { text: 'Люблю работать с возражениями, это часть процесса', score: 5 },
    ],
  },
  {
    id: '17',
    text: 'Как быстро вы устанавливаете доверительные отношения?',
    category: 'relationships',
    options: [
      { text: 'Очень медленно, люди долго ко мне привыкают', score: 1 },
      { text: 'Нужно время, не всегда получается', score: 2 },
      { text: 'В среднем темпе, с некоторыми лучше', score: 3 },
      { text: 'Довольно быстро завоевываю доверие', score: 4 },
      { text: 'Очень быстро, люди мне сразу доверяют', score: 5 },
    ],
  },
  {
    id: '18',
    text: 'Что происходит с вами во время важной презентации?',
    category: 'communication',
    options: [
      { text: 'Сильно нервничаю, могу забыть текст', score: 1 },
      { text: 'Волнуюсь, но справляюсь', score: 2 },
      { text: 'Немного переживаю, но это не мешает', score: 3 },
      { text: 'Чувствую легкое волнение, но оно мотивирует', score: 4 },
      { text: 'Получаю кайф от внимания, выкладываюсь по полной', score: 5 },
    ],
  },
  {
    id: '19',
    text: 'Как вы ведете переговоры о цене?',
    category: 'persuasion',
    options: [
      { text: 'Избегаю торговаться, сразу даю скидку', score: 1 },
      { text: 'Неохотно, но иду на уступки', score: 2 },
      { text: 'Нормально веду переговоры в разумных пределах', score: 3 },
      { text: 'Уверенно обосновываю цену и торгуюсь', score: 4 },
      { text: 'Мастерски веду переговоры, получаю лучшие условия', score: 5 },
    ],
  },
  {
    id: '20',
    text: 'Насколько вы настойчивы в достижении продажи?',
    category: 'motivation',
    options: [
      { text: 'Не настойчив, быстро сдаюсь', score: 1 },
      { text: 'Делаю несколько попыток, потом отступаю', score: 2 },
      { text: 'Проявляю умеренную настойчивость', score: 3 },
      { text: 'Настойчив, но в разумных пределах', score: 4 },
      { text: 'Очень настойчив, не отступаю до последнего', score: 5 },
    ],
  },
];

export const calculateSalesPotentialResult = (
  answers: Record<string, number>
): SalesPotentialResult => {
  const total_score = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((total_score - 20) / 80) * 100);

  // Подсчет баллов по категориям
  const category_scores = {
    communication: 0,
    persuasion: 0,
    resilience: 0,
    relationships: 0,
    motivation: 0,
    adaptability: 0,
  };

  const categoryCount = {
    communication: 0,
    persuasion: 0,
    resilience: 0,
    relationships: 0,
    motivation: 0,
    adaptability: 0,
  };

  salesPotentialQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer !== undefined) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    if (categoryCount[key] > 0) {
      category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
    }
  });

  let overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  let title: string;
  let description: string;
  let strengths: string[];
  let challenges: string[];
  let personality_traits: string[];
  let ideal_sales_types: string[];
  let development_areas: string[];
  let success_strategies: string[];
  let training_recommendations: string[];
  let career_paths: string[];
  let warning_signs: string[];

  if (total_score <= 40) {
    overall_level = 'low';
    title = 'Низкий потенциал в продажах';
    description =
      'Продажи могут не быть вашей сильной стороной. Вам может быть некомфортно в активных продажах, но это не означает, что вы не можете развить эти навыки или найти свою нишу в смежных областях.';
    strengths = [
      'Честность и искренность',
      'Внимание к деталям продукта',
      'Консультативный подход',
      'Способность к глубоким отношениям',
    ];
    challenges = [
      'Трудности с активными продажами',
      'Низкая устойчивость к отказам',
      'Дискомфорт при убеждении',
      'Сложности с холодными контактами',
      'Избегание конфронтации',
    ];
    ideal_sales_types = [
      'Техническое консультирование',
      'Работа с входящими заявками',
      'Поддержка существующих клиентов',
      'Внутренние продажи',
    ];
    warning_signs = [
      'Избегание контакта с клиентами',
      'Стресс от переговоров',
      'Низкие результаты продаж',
      'Нежелание работать с возражениями',
    ];
  } else if (total_score <= 55) {
    overall_level = 'below_average';
    title = 'Ниже среднего потенциал в продажах';
    description =
      'У вас есть некоторые способности к продажам, но они требуют развития. С правильным обучением и поддержкой вы можете достичь приемлемых результатов в определенных типах продаж.';
    strengths = [
      'Потенциал для развития',
      'Базовые коммуникативные навыки',
      'Способность к обучению',
      'Аналитический подход',
    ];
    challenges = [
      'Недостаток уверенности',
      'Слабые навыки убеждения',
      'Трудности с активными продажами',
      'Низкая мотивация к соревнованию',
    ];
    ideal_sales_types = [
      'Продажи в команде',
      'Консультативные продажи',
      'B2B продажи с длинным циклом',
      'Специализированные продукты',
    ];
    warning_signs = [
      'Избегание сложных клиентов',
      'Быстрая сдача при возражениях',
      'Низкая активность в поиске клиентов',
    ];
  } else if (total_score <= 70) {
    overall_level = 'average';
    title = 'Средний потенциал в продажах';
    description =
      'У вас хороший базовый потенциал для работы в продажах. Вы можете быть успешными во многих типах продаж, особенно с дополнительным обучением и опытом.';
    strengths = [
      'Сбалансированные навыки',
      'Умеренная настойчивость',
      'Способность к адаптации',
      'Хорошие отношения с клиентами',
    ];
    challenges = [
      'Недостаток исключительных навыков',
      'Средняя мотивация',
      'Требуется постоянное развитие',
    ];
    ideal_sales_types = [
      'Розничные продажи',
      'Корпоративные продажи',
      'Продажи услуг',
      'Региональные продажи',
    ];
    warning_signs = ['Плато в развитии', 'Средние результаты без роста'];
  } else if (total_score <= 85) {
    overall_level = 'above_average';
    title = 'Выше среднего потенциал в продажах';
    description =
      'У вас отличный потенциал для успешной карьеры в продажах. Вы обладаете большинством необходимых качеств и можете достигать высоких результатов в различных типах продаж.';
    strengths = [
      'Сильные коммуникативные навыки',
      'Хорошая устойчивость к стрессу',
      'Способность убеждать',
      'Мотивация к достижениям',
      'Адаптивность',
    ];
    challenges = ['Требуется шлифовка некоторых навыков', 'Возможная самоуверенность'];
    ideal_sales_types = [
      'Ключевые клиенты',
      'Сложные продажи',
      'Новые рынки',
      'Управление продажами',
    ];
    warning_signs = ['Минимальные'];
  } else {
    overall_level = 'high';
    title = 'Высокий потенциал в продажах';
    description =
      'У вас исключительный потенциал для продаж. Вы обладаете природными талантами продавца и можете достигать выдающихся результатов в любом типе продаж. Карьера в продажах может принести вам большой успех.';
    strengths = [
      'Исключительные коммуникативные навыки',
      'Высокая мотивация и настойчивость',
      'Отличные навыки убеждения',
      'Быстрая адаптация',
      'Природная харизма',
      'Любовь к вызовам',
    ];
    challenges = ['Риск выгорания от высокой активности', 'Возможная переоценка способностей'];
    ideal_sales_types = [
      'Сложные B2B продажи',
      'Элитные продукты',
      'Международные продажи',
      'Руководство отделом продаж',
    ];
    warning_signs = ['Практически отсутствуют'];
  }

  // Навыки продаж
  const sales_skills = [
    'Построение отношений с клиентами',
    'Выявление потребностей',
    'Презентация продукта/услуги',
    'Работа с возражениями',
    'Закрытие сделки',
    'Переговоры о цене',
    'Ведение CRM системы',
    'Планирование продаж',
  ];

  // Личностные качества
  if (overall_level === 'low' || overall_level === 'below_average') {
    personality_traits = [
      'Интровертированность',
      'Осторожность',
      'Аналитичность',
      'Стремление к стабильности',
      'Избегание конфликтов',
    ];

    development_areas = [
      'Развитие уверенности в себе',
      'Тренировка навыков общения',
      'Работа с отказами',
      'Изучение техник продаж',
      'Развитие стрессоустойчивости',
    ];

    training_recommendations = [
      'Базовый курс продаж',
      'Тренинги по коммуникации',
      'Курсы уверенности в себе',
      'Работа с ментором',
      'Постепенное увеличение нагрузки',
    ];

    success_strategies = [
      'Начинать с простых продуктов',
      'Работать в паре с опытным продавцом',
      'Фокусироваться на консультировании',
      'Использовать письменные материалы',
      'Развивать экспертность в продукте',
    ];

    career_paths = [
      'Техническая поддержка продаж',
      'Маркетинг',
      'Менеджер по работе с клиентами',
      'Специалист по продукту',
      'Внутренние продажи',
    ];
  } else if (overall_level === 'average') {
    personality_traits = [
      'Умеренная общительность',
      'Сбалансированность',
      'Обучаемость',
      'Стабильность',
      'Командность',
    ];

    development_areas = [
      'Углубление техник продаж',
      'Развитие лидерских качеств',
      'Улучшение навыков презентации',
      'Изучение психологии клиента',
      'Развитие переговорных навыков',
    ];

    training_recommendations = [
      'Продвинутые курсы продаж',
      'Специализация по отраслям',
      'Тренинги по переговорам',
      'Обучение работе с CRM',
      'Развитие эмоционального интеллекта',
    ];

    success_strategies = [
      'Специализация на определенном сегменте',
      'Построение долгосрочных отношений',
      'Постоянное обучение',
      'Использование аналитики',
      'Командная работа',
    ];

    career_paths = [
      'Менеджер по продажам',
      'Специалист по ключевым клиентам',
      'Региональный менеджер',
      'Тренер по продажам',
      'Руководитель направления',
    ];
  } else {
    personality_traits = [
      'Экстравертированность',
      'Высокая энергия',
      'Амбициозность',
      'Конкурентность',
      'Харизматичность',
    ];

    development_areas = [
      'Лидерство и управление командой',
      'Стратегическое планирование',
      'Международные продажи',
      'Цифровые каналы продаж',
      'Построение партнерств',
    ];

    training_recommendations = [
      'MBA или бизнес-образование',
      'Тренинги по лидерству',
      'Изучение новых технологий',
      'Международные программы',
      'Менторство других',
    ];

    success_strategies = [
      'Работа с крупными клиентами',
      'Развитие новых рынков',
      'Построение команды',
      'Использование данных и аналитики',
      'Инновации в продажах',
    ];

    career_paths = [
      'Директор по продажам',
      'Вице-президент по развитию',
      'Собственный бизнес',
      'Международные продажи',
      'Консультант по продажам',
    ];
  }

  return {
    overall_level,
    total_score,
    percentage,
    title,
    description,
    category_scores,
    strengths,
    challenges,
    sales_skills,
    personality_traits,
    ideal_sales_types,
    development_areas,
    success_strategies,
    training_recommendations,
    career_paths,
    warning_signs,
  };
};
