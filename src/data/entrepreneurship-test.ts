/**
 * Тест на предпринимательский потенциал
 * Оценивает склонности и способности к предпринимательской деятельности
 */

export interface EntrepreneurshipQuestion {
  id: string;
  text: string;
  category: 'risk_taking' | 'innovation' | 'leadership' | 'persistence' | 'opportunity_recognition' | 'resource_management';
  options: {
    text: string;
    score: number; // 1 (низкий потенциал) до 5 (высокий потенциал)
  }[];
}

export interface EntrepreneurshipResult {
  overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  total_score: number; // от 22 до 110
  percentage: number; // 0-100
  title: string;
  description: string;
  category_scores: {
    risk_taking: number;           // Готовность к риску
    innovation: number;            // Инновационность
    leadership: number;            // Лидерские качества
    persistence: number;           // Настойчивость
    opportunity_recognition: number; // Распознавание возможностей
    resource_management: number;    // Управление ресурсами
  };
  strengths: string[];
  challenges: string[];
  entrepreneurial_traits: string[];
  business_areas: string[];
  success_factors: string[];
  development_recommendations: string[];
  startup_readiness: string[];
  funding_strategies: string[];
  networking_advice: string[];
  warning_signs: string[];
  next_steps: string[];
}

export const entrepreneurshipQuestions: EntrepreneurshipQuestion[] = [
  {
    id: '1',
    text: 'Как вы относитесь к неопределенности в бизнесе?',
    category: 'risk_taking',
    options: [
      { text: 'Избегаю любой неопределенности, предпочитаю стабильность', score: 1 },
      { text: 'Неопределенность меня беспокоит, стараюсь минимизировать', score: 2 },
      { text: 'Принимаю неопределенность как данность', score: 3 },
      { text: 'Комфортно чувствую себя в неопределенности', score: 4 },
      { text: 'Неопределенность меня вдохновляет и мотивирует', score: 5 }
    ]
  },
  {
    id: '2',
    text: 'Насколько часто вы придумываете новые идеи для бизнеса или улучшения?',
    category: 'innovation',
    options: [
      { text: 'Редко, не склонен к генерации идей', score: 1 },
      { text: 'Иногда, когда специально думаю об этом', score: 2 },
      { text: 'Регулярно замечаю возможности для улучшения', score: 3 },
      { text: 'Часто генерирую новые идеи и концепции', score: 4 },
      { text: 'Постоянно, у меня множество бизнес-идей', score: 5 }
    ]
  },
  {
    id: '3',
    text: 'Как вы ведете себя в ситуации, когда нужно принять важное решение без полной информации?',
    category: 'risk_taking',
    options: [
      { text: 'Откладываю решение до получения всей информации', score: 1 },
      { text: 'Очень долго анализирую имеющиеся данные', score: 2 },
      { text: 'Принимаю решение на основе доступной информации', score: 3 },
      { text: 'Быстро принимаю решение, доверяя интуиции', score: 4 },
      { text: 'Легко принимаю решения в условиях неполной информации', score: 5 }
    ]
  },
  {
    id: '4',
    text: 'Как вы реагируете на неудачи и провалы?',
    category: 'persistence',
    options: [
      { text: 'Сильно расстраиваюсь и долго не могу прийти в себя', score: 1 },
      { text: 'Расстраиваюсь, но постепенно восстанавливаюсь', score: 2 },
      { text: 'Анализирую ошибки и делаю выводы', score: 3 },
      { text: 'Быстро восстанавливаюсь и ищу новые подходы', score: 4 },
      { text: 'Воспринимаю как ценный опыт и мотивацию для новых попыток', score: 5 }
    ]
  },
  {
    id: '5',
    text: 'Насколько легко вам мотивировать и вести за собой других?',
    category: 'leadership',
    options: [
      { text: 'Очень сложно, не люблю быть лидером', score: 1 },
      { text: 'Сложно, но иногда приходится', score: 2 },
      { text: 'Нормально справляюсь в знакомых ситуациях', score: 3 },
      { text: 'Легко беру на себя лидерство', score: 4 },
      { text: 'Естественно становлюсь лидером, легко вдохновляю других', score: 5 }
    ]
  },
  {
    id: '6',
    text: 'Как часто вы замечаете проблемы, которые можно решить новым продуктом или услугой?',
    category: 'opportunity_recognition',
    options: [
      { text: 'Редко обращаю внимание на такие вещи', score: 1 },
      { text: 'Иногда замечаю очевидные проблемы', score: 2 },
      { text: 'Регулярно вижу возможности для улучшения', score: 3 },
      { text: 'Часто идентифицирую потребности рынка', score: 4 },
      { text: 'Постоянно анализирую рынок на предмет новых возможностей', score: 5 }
    ]
  },
  {
    id: '7',
    text: 'Как вы относитесь к работе с ограниченными ресурсами?',
    category: 'resource_management',
    options: [
      { text: 'Это меня демотивирует, нужны все ресурсы', score: 1 },
      { text: 'Сложно работать без достаточных ресурсов', score: 2 },
      { text: 'Справляюсь, но предпочитаю иметь все необходимое', score: 3 },
      { text: 'Хорошо работаю с ограничениями, нахожу альтернативы', score: 4 },
      { text: 'Ограничения стимулируют креативность и изобретательность', score: 5 }
    ]
  },
  {
    id: '8',
    text: 'Насколько вы готовы работать сверхурочно ради достижения цели?',
    category: 'persistence',
    options: [
      { text: 'Предпочитаю работать строго по графику', score: 1 },
      { text: 'Иногда могу задержаться при необходимости', score: 2 },
      { text: 'Готов работать больше обычного при важных проектах', score: 3 },
      { text: 'Легко работаю сверхурочно ради достижения целей', score: 4 },
      { text: 'Готов полностью посвятить себя важному проекту', score: 5 }
    ]
  },
  {
    id: '9',
    text: 'Как вы относитесь к конкуренции?',
    category: 'leadership',
    options: [
      { text: 'Избегаю конкурентной среды', score: 1 },
      { text: 'Конкуренция меня напрягает', score: 2 },
      { text: 'Нормально отношусь, но не стремлюсь', score: 3 },
      { text: 'Конкуренция меня мотивирует', score: 4 },
      { text: 'Обожаю конкуренцию, она раскрывает мой потенциал', score: 5 }
    ]
  },
  {
    id: '10',
    text: 'Какова ваша реакция на критику бизнес-идеи?',
    category: 'innovation',
    options: [
      { text: 'Отказываюсь от идеи при первой критике', score: 1 },
      { text: 'Расстраиваюсь и сомневаюсь в идее', score: 2 },
      { text: 'Анализирую критику и дорабатываю идею', score: 3 },
      { text: 'Использую критику для улучшения концепции', score: 4 },
      { text: 'Воспринимаю как ценную обратную связь для развития', score: 5 }
    ]
  },
  {
    id: '11',
    text: 'Насколько комфортно вам продавать свою идею или продукт?',
    category: 'leadership',
    options: [
      { text: 'Очень некомфортно, избегаю продаж', score: 1 },
      { text: 'Неудобно, но делаю когда необходимо', score: 2 },
      { text: 'Нормально справляюсь с основными задачами', score: 3 },
      { text: 'Уверенно презентую и убеждаю', score: 4 },
      { text: 'Обожаю продавать идеи, легко вдохновляю других', score: 5 }
    ]
  },
  {
    id: '12',
    text: 'Как вы находите нужную информацию и ресурсы?',
    category: 'resource_management',
    options: [
      { text: 'С трудом, не знаю с чего начать', score: 1 },
      { text: 'Ищу в привычных источниках', score: 2 },
      { text: 'Использую различные каналы поиска', score: 3 },
      { text: 'Активно ищу и легко нахожу необходимое', score: 4 },
      { text: 'Быстро нахожу любые ресурсы через широкую сеть контактов', score: 5 }
    ]
  },
  {
    id: '13',
    text: 'Как вы относитесь к возможности потерять вложенные деньги?',
    category: 'risk_taking',
    options: [
      { text: 'Категорически не готов рисковать деньгами', score: 1 },
      { text: 'Готов рисковать только минимальными суммами', score: 2 },
      { text: 'Могу рискнуть разумной суммой при хорошей идее', score: 3 },
      { text: 'Готов рисковать значительными суммами ради возможности', score: 4 },
      { text: 'Готов поставить все на кон ради перспективной идеи', score: 5 }
    ]
  },
  {
    id: '14',
    text: 'Насколько легко вам адаптироваться к изменениям рынка?',
    category: 'opportunity_recognition',
    options: [
      { text: 'Очень тяжело, предпочитаю стабильность', score: 1 },
      { text: 'Сложно, нужно время на адаптацию', score: 2 },
      { text: 'Постепенно приспосабливаюсь к изменениям', score: 3 },
      { text: 'Быстро адаптируюсь и нахожу новые возможности', score: 4 },
      { text: 'Изменения стимулируют меня искать новые решения', score: 5 }
    ]
  },
  {
    id: '15',
    text: 'Как долго вы можете работать над проектом, не видя быстрых результатов?',
    category: 'persistence',
    options: [
      { text: 'Недолго, нужны быстрые результаты', score: 1 },
      { text: 'Несколько недель, потом теряю мотивацию', score: 2 },
      { text: 'Несколько месяцев при наличии плана', score: 3 },
      { text: 'Готов работать год и больше ради большой цели', score: 4 },
      { text: 'Могу работать годами, если верю в идею', score: 5 }
    ]
  },
  {
    id: '16',
    text: 'Как вы относитесь к делегированию задач?',
    category: 'leadership',
    options: [
      { text: 'Предпочитаю делать все сам', score: 1 },
      { text: 'Делегирую неохотно, не доверяю', score: 2 },
      { text: 'Делегирую простые задачи', score: 3 },
      { text: 'Эффективно распределяю задачи в команде', score: 4 },
      { text: 'Мастерски делегирую, развивая команду', score: 5 }
    ]
  },
  {
    id: '17',
    text: 'Насколько хорошо вы видите потенциал в людях?',
    category: 'opportunity_recognition',
    options: [
      { text: 'Плохо разбираюсь в людях', score: 1 },
      { text: 'Иногда угадываю способности', score: 2 },
      { text: 'В целом понимаю сильные стороны людей', score: 3 },
      { text: 'Хорошо вижу талант и потенциал', score: 4 },
      { text: 'Отлично распознаю таланты и помогаю их развить', score: 5 }
    ]
  },
  {
    id: '18',
    text: 'Как вы планируете использование денежных средств?',
    category: 'resource_management',
    options: [
      { text: 'Плохо планирую, часто трачу импульсивно', score: 1 },
      { text: 'Составляю простые планы трат', score: 2 },
      { text: 'Веду учет доходов и расходов', score: 3 },
      { text: 'Детально планирую бюджет и инвестиции', score: 4 },
      { text: 'Мастерски управляю финансами для максимального результата', score: 5 }
    ]
  },
  {
    id: '19',
    text: 'Как вы относитесь к инновациям и новым технологиям?',
    category: 'innovation',
    options: [
      { text: 'Настороженно, предпочитаю проверенное', score: 1 },
      { text: 'Жду, пока технологии станут массовыми', score: 2 },
      { text: 'Изучаю и внедряю постепенно', score: 3 },
      { text: 'Активно изучаю и быстро внедряю', score: 4 },
      { text: 'Стараюсь быть первым в использовании инноваций', score: 5 }
    ]
  },
  {
    id: '20',
    text: 'Насколько готовы пожертвовать стабильностью ради развития бизнеса?',
    category: 'risk_taking',
    options: [
      { text: 'Не готов жертвовать стабильностью', score: 1 },
      { text: 'Могу пожертвовать малым ради безопасности', score: 2 },
      { text: 'Готов на умеренные жертвы ради роста', score: 3 },
      { text: 'Готов рисковать стабильностью ради больших возможностей', score: 4 },
      { text: 'Полностью готов отказаться от стабильности ради мечты', score: 5 }
    ]
  },
  {
    id: '21',
    text: 'Как быстро вы принимаете решение о найме сотрудника?',
    category: 'resource_management',
    options: [
      { text: 'Очень долго, много раз перепроверяю', score: 1 },
      { text: 'Долго анализирую всех кандидатов', score: 2 },
      { text: 'Принимаю решение после нескольких встреч', score: 3 },
      { text: 'Довольно быстро определяю подходящего кандидата', score: 4 },
      { text: 'Быстро распознаю таланты и принимаю решения', score: 5 }
    ]
  },
  {
    id: '22',
    text: 'Что вас больше всего мотивирует в предпринимательстве?',
    category: 'innovation',
    options: [
      { text: 'Стабильный доход и безопасность', score: 1 },
      { text: 'Возможность не работать на других', score: 2 },
      { text: 'Реализация своих идей', score: 3 },
      { text: 'Создание чего-то значимого для общества', score: 4 },
      { text: 'Революционные изменения и влияние на мир', score: 5 }
    ]
  }
];

export const calculateEntrepreneurshipResult = (answers: Record<string, number>): EntrepreneurshipResult => {
  const total_score = Object.values(answers).reduce((sum, score) => sum + score, 0);
  const percentage = Math.round(((total_score - 22) / 88) * 100);

  // Подсчет баллов по категориям
  const category_scores = {
    risk_taking: 0,
    innovation: 0,
    leadership: 0,
    persistence: 0,
    opportunity_recognition: 0,
    resource_management: 0
  };

  const categoryCount = {
    risk_taking: 0,
    innovation: 0,
    leadership: 0,
    persistence: 0,
    opportunity_recognition: 0,
    resource_management: 0
  };

  entrepreneurshipQuestions.forEach((question) => {
    const answer = answers[question.id];
    if (answer !== undefined) {
      category_scores[question.category] += answer;
      categoryCount[question.category]++;
    }
  });

  // Нормализуем оценки по категориям
  Object.keys(category_scores).forEach((category) => {
    const key = category as keyof typeof category_scores;
    if (categoryCount[key] > 0) {
      category_scores[key] = Math.round((category_scores[key] / categoryCount[key]) * 20);
    }
  });

  let overall_level: 'low' | 'below_average' | 'average' | 'above_average' | 'high';
  let title: string;
  let description: string;
  let strengths: string[];
  let challenges: string[];
  let entrepreneurial_traits: string[];
  let business_areas: string[];
  let success_factors: string[];
  let development_recommendations: string[];
  let startup_readiness: string[];
  let funding_strategies: string[];
  let networking_advice: string[];
  let warning_signs: string[];
  let next_steps: string[];

  if (total_score <= 44) {
    overall_level = 'low';
    title = 'Низкий предпринимательский потенциал';
    description = 'Предпринимательство может не быть вашей естественной склонностью. Вы цените стабильность и предсказуемость. Это не означает, что вы не можете стать предпринимателем, но потребуется значительное развитие навыков и изменение мышления.';
    strengths = [
      'Осторожность в принятии решений',
      'Стремление к стабильности',
      'Аналитический подход',
      'Внимание к деталям'
    ];
    challenges = [
      'Избегание риска',
      'Низкая толерантность к неопределенности',
      'Слабые лидерские навыки',
      'Недостаток настойчивости',
      'Трудности с инновациями'
    ];
    entrepreneurial_traits = [
      'Потребность в безопасности',
      'Предпочтение структуры',
      'Осторожность',
      'Консерватизм'
    ];
    business_areas = [
      'Франшизы с проверенной моделью',
      'Традиционные услуги',
      'Консультирование в области экспертизы',
      'Партнерство с опытным предпринимателем'
    ];
    warning_signs = [
      'Полное избегание любых рисков',
      'Отказ от возможностей из-за страха',
      'Неспособность принимать быстрые решения',
      'Зависимость от одобрения других'
    ];
  } else if (total_score <= 66) {
    overall_level = 'below_average';
    title = 'Ниже среднего предпринимательский потенциал';
    description = 'У вас есть некоторые предпринимательские качества, но они нуждаются в развитии. С правильным обучением и поддержкой вы можете стать успешным предпринимателем в определенных областях.';
    strengths = [
      'Базовые лидерские качества',
      'Способность к обучению',
      'Некоторая готовность к изменениям',
      'Потенциал для роста'
    ];
    challenges = [
      'Недостаток уверенности',
      'Ограниченная готовность к риску',
      'Слабые навыки распознавания возможностей',
      'Низкая настойчивость'
    ];
    entrepreneurial_traits = [
      'Потенциальная лидерская способность',
      'Обучаемость',
      'Некоторая амбициозность',
      'Базовая креативность'
    ];
    business_areas = [
      'Социальное предпринимательство',
      'Местные услуги',
      'Онлайн бизнес с низким стартовым капиталом',
      'Консультирование'
    ];
    warning_signs = [
      'Быстрая сдача при первых трудностях',
      'Избегание сложных решений',
      'Зависимость от мнения других'
    ];
  } else if (total_score <= 88) {
    overall_level = 'average';
    title = 'Средний предпринимательский потенциал';
    description = 'У вас хорошие базовые предпринимательские качества. С дополнительным развитием навыков и опыта вы можете создать успешный бизнес в различных областях.';
    strengths = [
      'Сбалансированный подход к риску',
      'Базовые лидерские навыки',
      'Способность к адаптации',
      'Умеренная настойчивость'
    ];
    challenges = [
      'Нужно развивать инновационное мышление',
      'Требуется больше уверенности',
      'Улучшение навыков управления ресурсами'
    ];
    entrepreneurial_traits = [
      'Умеренная амбициозность',
      'Способность к командной работе',
      'Практичность',
      'Обучаемость'
    ];
    business_areas = [
      'Розничная торговля',
      'Услуги для бизнеса',
      'Электронная коммерция',
      'Региональные франшизы'
    ];
    warning_signs = [
      'Остановка в развитии',
      'Избегание больших возможностей'
    ];
  } else if (total_score <= 99) {
    overall_level = 'above_average';
    title = 'Выше среднего предпринимательский потенциал';
    description = 'У вас сильный предпринимательский потенциал. Вы обладаете большинством ключевых качеств успешного предпринимателя и можете создать процветающий бизнес в различных сферах.';
    strengths = [
      'Сильные лидерские качества',
      'Хорошая толерантность к риску',
      'Способность к инновациям',
      'Настойчивость в достижении целей',
      'Умение распознавать возможности'
    ];
    challenges = [
      'Нужно избегать излишней самоуверенности',
      'Важно развивать системность в управлении'
    ];
    entrepreneurial_traits = [
      'Высокая мотивация',
      'Инновационность',
      'Лидерство',
      'Готовность к вызовам'
    ];
    business_areas = [
      'Технологические стартапы',
      'Инновационные продукты',
      'Высокотехнологичные услуги',
      'Масштабируемые бизнес-модели'
    ];
    warning_signs = ['Минимальные'];
  } else {
    overall_level = 'high';
    title = 'Высокий предпринимательский потенциал';
    description = 'У вас исключительный предпринимательский потенциал. Вы обладаете всеми ключевыми качествами успешного предпринимателя и можете создать революционные компании и продукты.';
    strengths = [
      'Исключительные лидерские качества',
      'Высокая толерантность к риску',
      'Выдающаяся способность к инновациям',
      'Железная настойчивость',
      'Отличное распознавание возможностей',
      'Мастерское управление ресурсами'
    ];
    challenges = [
      'Риск перегорания',
      'Возможное пренебрежение деталями',
      'Потенциальная нетерпимость к медленным процессам'
    ];
    entrepreneurial_traits = [
      'Визионерство',
      'Харизматичность',
      'Революционное мышление',
      'Безграничная энергия'
    ];
    business_areas = [
      'Прорывные технологии',
      'Глобальные платформы',
      'Революционные продукты',
      'Новые индустрии'
    ];
    warning_signs = ['Практически отсутствуют'];
  }

  // Факторы успеха
  success_factors = [
    'Развитие сети контактов',
    'Постоянное обучение и адаптация',
    'Фокус на потребностях клиентов',
    'Эффективное управление финансами',
    'Создание сильной команды'
  ];

  // Рекомендации по развитию
  if (overall_level === 'low' || overall_level === 'below_average') {
    development_recommendations = [
      'Начните с малого бизнеса или побочного проекта',
      'Изучите основы предпринимательства',
      'Найдите ментора или опытного партнера',
      'Развивайте толерантность к риску постепенно',
      'Практикуйте лидерские навыки в текущей работе'
    ];

    startup_readiness = [
      'Начните с проверки идеи на рынке',
      'Создайте детальный бизнес-план',
      'Накопите финансовую подушку',
      'Изучите целевую аудиторию',
      'Найдите опытного со-основателя'
    ];

    funding_strategies = [
      'Собственные сбережения',
      'Займы от семьи и друзей',
      'Микрокредитование',
      'Краудфандинг',
      'Государственные гранты'
    ];
  } else if (overall_level === 'average') {
    development_recommendations = [
      'Развивайте инновационное мышление',
      'Изучайте успешные бизнес-кейсы',
      'Участвуйте в предпринимательских сообществах',
      'Развивайте навыки продаж и маркетинга',
      'Практикуйте финансовое планирование'
    ];

    startup_readiness = [
      'Проведите маркетинговое исследование',
      'Создайте MVP (минимальный жизнеспособный продукт)',
      'Найдите первых клиентов',
      'Разработайте стратегию выхода на рынок',
      'Подготовьте финансовые прогнозы'
    ];

    funding_strategies = [
      'Бутстрапинг',
      'Банковские кредиты',
      'Инвестиции бизнес-ангелов',
      'Краудфандинг',
      'Стратегические партнерства'
    ];
  } else {
    development_recommendations = [
      'Развивайте навыки стратегического мышления',
      'Изучайте международные рынки',
      'Создавайте экосистему партнеров',
      'Развивайте навыки управления масштабом',
      'Инвестируйте в личный бренд'
    ];

    startup_readiness = [
      'Создайте команду мирового класса',
      'Разработайте масштабируемую бизнес-модель',
      'Подготовьтесь к международной экспансии',
      'Создайте интеллектуальную собственность',
      'Разработайте стратегию выхода'
    ];

    funding_strategies = [
      'Венчурное инвестирование',
      'Стратегические инвесторы',
      'IPO подготовка',
      'Международные фонды',
      'Корпоративные инкубаторы'
    ];
  }

  // Советы по нетворкингу
  networking_advice = [
    'Активно участвуйте в предпринимательских событиях',
    'Создавайте ценность для других до просьб о помощи',
    'Поддерживайте регулярный контакт с сетью',
    'Ищите менторов в вашей области',
    'Присоединяйтесь к профессиональным ассоциациям'
  ];

  // Следующие шаги
  if (overall_level === 'low' || overall_level === 'below_average') {
    next_steps = [
      'Оцените свою текущую ситуацию и мотивацию',
      'Найдите область, где у вас есть экспертиза',
      'Начните с малого проекта или подработки',
      'Изучите основы ведения бизнеса',
      'Найдите ментора или присоединитесь к сообществу'
    ];
  } else if (overall_level === 'average') {
    next_steps = [
      'Проведите анализ рынка в интересной области',
      'Разработайте и протестируйте бизнес-идею',
      'Создайте бизнес-план',
      'Найдите потенциальных партнеров или инвесторов',
      'Зарегистрируйте юридическое лицо'
    ];
  } else {
    next_steps = [
      'Определите революционную идею или возможность',
      'Соберите команду экспертов',
      'Создайте прототип или MVP',
      'Привлеките первых инвесторов',
      'Запустите продукт на рынок'
    ];
  }

  return {
    overall_level,
    total_score,
    percentage,
    title,
    description,
    category_scores,
    strengths,
    challenges,
    entrepreneurial_traits,
    business_areas,
    success_factors,
    development_recommendations,
    startup_readiness,
    funding_strategies,
    networking_advice,
    warning_signs,
    next_steps
  };
};