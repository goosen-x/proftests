# Настройка GitHub Secrets для CI/CD

Для работы автоматического деплоя необходимо настроить следующие секреты в настройках репозитория GitHub:

## Необходимые секреты

1. **DEPLOY_HOST**
   - IP адрес или домен вашего сервера
   - Пример: `123.45.67.89` или `your-server.com`

2. **DEPLOY_USER**
   - Имя пользователя для SSH подключения
   - Обычно: `admin` или ваш пользователь

3. **DEPLOY_PORT**
   - SSH порт сервера
   - По умолчанию: `22`

4. **DEPLOY_KEY**
   - Приватный SSH ключ для подключения к серверу
   - Должен быть в формате PEM
   - См. инструкцию ниже для генерации

5. **SLACK_WEBHOOK** (опционально)
   - URL webhook для уведомлений в Slack
   - Можно удалить из workflow если не используется

## Как настроить секреты

1. Перейдите в Settings → Secrets and variables → Actions
2. Нажмите "New repository secret"
3. Добавьте каждый секрет с соответствующим значением

## Генерация SSH ключа для деплоя

### На локальной машине:

```bash
# Генерируем новый SSH ключ
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_deploy_key

# Копируем приватный ключ (для GitHub Secret)
cat ~/.ssh/github_deploy_key
# Скопируйте весь вывод и используйте как DEPLOY_KEY

# Копируем публичный ключ (для сервера)
cat ~/.ssh/github_deploy_key.pub
```

### На сервере:

```bash
# Добавляем публичный ключ в authorized_keys
echo "ваш_публичный_ключ" >> ~/.ssh/authorized_keys

# Устанавливаем правильные права
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

## Проверка подключения

После настройки проверьте подключение:

```bash
ssh -i ~/.ssh/github_deploy_key -p 22 admin@your-server-ip
```

## Дополнительные настройки

### Если используется нестандартный порт SSH:

1. Обновите DEPLOY_PORT в секретах
2. Убедитесь что порт открыт в firewall

### Если нужны дополнительные переменные окружения:

1. Добавьте их в секреты GitHub
2. Обновите workflow файл для использования этих переменных

## Безопасность

- Никогда не коммитьте приватные ключи в репозиторий
- Используйте отдельный SSH ключ только для деплоя
- Ограничьте права пользователя для деплоя
- Регулярно обновляйте ключи

## Troubleshooting

### Ошибка "Permission denied":

- Проверьте права на .ssh директорию и файлы
- Убедитесь что публичный ключ добавлен в authorized_keys

### Ошибка "Host key verification failed":

- Добавьте сервер в known_hosts локально
- Или используйте StrictHostKeyChecking=no (не рекомендуется для продакшена)

### Деплой не работает:

- Проверьте логи в Actions
- Убедитесь что все секреты настроены правильно
- Проверьте что пользователь имеет права на директорию деплоя
